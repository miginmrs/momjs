!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs"),require("altern-map"),require("rxjs/operators"),require("dependent-type"),require("rx-async"),require("rxjs/internal/observable/combineLatest")):"function"==typeof define&&define.amd?define(["rxjs","altern-map","rxjs/operators","dependent-type","rx-async","rxjs/internal/observable/combineLatest"],t):"object"==typeof exports?exports.rxrmi=t(require("rxjs"),require("altern-map"),require("rxjs/operators"),require("dependent-type"),require("rx-async"),require("rxjs/internal/observable/combineLatest")):e.rxrmi=t(e.rxjs,e["altern-map"],e.rxjs.operators,e["dependent-type"],e["rx-async"],e.rxjs.internal.observable.combineLatest)}(self,(function(e,t,r,s,n,i){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.current=t.on=t.eagerCombineAll=void 0;const s=r(0),n=r(12);class i extends s.Subscriber{notifyComplete(){var e,t;null===(t=(e=this.destination).complete)||void 0===t||t.call(e)}}t.eagerCombineAll=function(...e){if(0===e.length||1===e.length&&e[0]instanceof Array&&0===e[0].length)return s.concat(s.of([]),s.NEVER);const t=s.combineLatest.apply(this,e);return t.operator.call=function(e,t){n.CombineLatestOperator.prototype.call(e,t).notifyComplete=i.prototype.notifyComplete},t},t.on=({complete:e,error:t,next:r,subscribe:n,teardown:i})=>o=>o.lift((function(o){const a=this;null==n||n();const c=new s.Subscription;return c.add(o.subscribe(e=>{null==r||r(e),a.next(e)},e=>{null==t||t(e),a.error(e)},()=>{null==e||e(),a.complete()})),c.add(i),c})),t.current=function(e,t){return e.subscribe(e=>t=e).unsubscribe(),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.subKey=t.byKey=t.asCond=t.toCond=void 0,t.toCond=e=>e,t.asCond=e=>e,t.byKey=(e,t)=>e[t],t.subKey=e=>e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Destructable=t.destructableCmp=void 0;const s=r(0),n=r(4),i=r(1),o=r(5),a=r(2);r(1),t.destructableCmp=({compareData:e=((e,t)=>e===t),compareObs:t=((e,t)=>e===t)}={})=>(r,s)=>r.args.length===s.args.length&&r.args.every((e,r)=>{const n=e,i=s.args[r];return n instanceof Array?i instanceof Array&&(n.length===i.length&&n.every((e,t)=>e===i[t])):!(i instanceof Array)&&t(n,i)})&&e(r.data,s.data);class c extends s.Observable{constructor(e,r,a,c,u=t.destructableCmp(),...l){super(),this.handlers=e,this.key=r,this.c=a,this.origin=this,this.parent=this;const d=this.handler;this.subject=new s.BehaviorSubject(c),this.destroy=new s.Subscription(()=>{this.subject.isStopped?this.subject.closed=!0:this.subject.unsubscribe()}),l.forEach(e=>this.destroy.add(e)),this.source=new s.Observable(e=>{const t=this.subject.pipe(o.distinctUntilChanged(u),n.alternMap(({args:e,data:t})=>{const r=e.map(e=>e instanceof Array?i.eagerCombineAll(e):e);return i.eagerCombineAll(r).pipe(o.map(e=>(e[0]instanceof Array&&(e[0],e[1]),[e,t,a])))},{completeWithInner:!0,completeWithSource:!0}),o.tap({error:e=>this.subject.error(e),complete:()=>this.subject.complete()}),o.scan((e,[t,r,s])=>d.ctr(t,r,s,e,this),null)).subscribe(e);return t.add(this.destroy),t}),this.operator=o.shareReplay({bufferSize:1,refCount:!0})(this).operator}get destroyed(){return this.destroy.closed}get handler(){return a.byKey(this.handlers,this.key)}}t.Destructable=c},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineProperty=void 0,t.defineProperty=function(e,t,r){return Object.defineProperty(e,t,r)}},function(e,t){e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickPromise=void 0;const s=e=>e;var n;!function(e){e[e.Pending=0]="Pending",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected",e[e.Alias=3]="Alias"}(n||(n={}));class i{constructor(e){this._thens=[],this._catchs=[],this._status=n.Pending,e(e=>{var t;if(this._status===n.Pending)if(null==(t=e)?void 0:t.then)this._status=n.Alias,this._promise=e,e.then(this._finilize(this._thens),this._finilize(this._catchs));else{const t=e;this._value=t,this._status=n.Resolved,this._finilize(this._thens)(t)}},e=>{this._status===n.Pending&&(this._error=e,this._status=n.Rejected,this._finilize(this._catchs)(e))})}_finilize(e){return t=>{e.forEach(e=>e(t)),this._thens=[],this._catchs=[]}}_tryRun(e,t,r){return s=>{try{const i=e(s);if(null==(n=i)?void 0:n.then)i.then(t,r);else{t(i)}}catch(e){r(e)}var n}}then(e,t){const r=null!=e?e:s;return new i((e,s)=>{if(this._status===n.Pending)this._thens.push(this._tryRun(r,e,s)),t?this._catchs.push(this._tryRun(t,e,s)):this._catchs.push(s);else if(this._status===n.Alias){this._promise.then(this._tryRun(r,e,s),t?this._tryRun(t,e,s):s)}else this._status===n.Resolved?this._tryRun(r,e,s)(this._value):t?this._tryRun(t,e,s)(this._error):s(this._error)})}catch(e){return this.then(null,e)}finally(e){if(!e)return this;const t=()=>{try{e()}catch(e){}};return this._status===n.Alias?this._promise.then(t,t):this._status===n.Pending?(this._thens.push(t),this._catchs.push(t)):t(),this}static resolve(e){return new i(t=>t(e))}static reject(e){return new i((t,r)=>r(e))}static all(e){const t=e instanceof Array?[...e]:{...e},r=Object.keys(e).filter(t=>e[t].then);let s=r.length;return new i((n,i)=>{s||n(t),r.forEach(r=>{e[r].then(e=>{t[r]=e,--s||n(t)},i)})})}}t.QuickPromise=i},function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||s(t,e,r)},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),i(r(11),t),i(r(13),t),i(r(3),t),i(r(15),t),i(r(16),t),i(r(6),t),t.rx_async=o(r(8)),t.altern_map=o(r(4)),t.utils=o(r(17))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Store=t.BiMap=t.asAsync=t.wait=t.runit=void 0;const s=r(0),n=r(3),i=r(2),o=r(6),a=r(1),c=r(7),u=r(5),l=r(4),d=r(8),{depMap:h}=o.map;t.runit=(e,t)=>{const r=(...s)=>{const n=s.length?e.next(s[0]):e.next();return n.done?t.resolve(n.value):t.resolve(n.value).then(r)};return r()},t.wait=function*(e){return yield e},t.asAsync=function(e,r,s){return(...n)=>t.runit(e.call(s,...n),r)};class p{constructor(){this.byId=new Map,this.byObs=new Map,this.oldId=new WeakMap}get(e){return this.byId.get(e)}delete(e){const t=this.byId.get(e);return t&&this.byObs.delete(t[0].origin),this.byId.delete(e)}set(e,t){this.byObs.set(t[0].origin,e),this.oldId.set(t[0].origin,e),this.byId.set(e,t)}reuseId(e,t){this.oldId.set(e,t)}find(e){return this.byObs.get(e)}usedId(e){return this.oldId.get(e)}get size(){return this.byId.size}keys(){return this.byId.keys()}entries(){return this.byId.entries()}values(){return this.byId.values()}}t.BiMap=p;const f=BigInt(1);t.Store=class{constructor(e,t,r,n=null,o,a="",c=new Map){this.handlers=e,this.extra=t,this.promiseCtr=r,this.functions=n,this.name=o,this.prefix=a,this.locals=c,this.map=new p,this.next=f,this.pushed=new Set,this.pushes=new s.Subject,this.changes=new s.Observable(e=>{const t=new Map,r=this.emptyContext,s=t=>{const s=t.handler.encode(r);return t.subject.pipe(u.scan((e,r)=>{const n={...r,..."old"in e?{old:e.old}:{},c:t.c};return{old:s(n),params:n}},{}),u.filter(({old:e},t)=>void 0!==e)).subscribe(({old:r,params:s})=>{e.next(["next",[{c:t.c,i:0,data:r,id:this.map.find(t),new:!("old"in(null!=s?s:{})),type:t.key}]])},r=>e.next(["error",{id:this.map.find(t)},r]),()=>e.next(["complete",{id:this.map.find(t)}]))};for(const e of this.pushed)t.set(e,s(e));e.add(this.pushes.subscribe(([r,n])=>{if(n)t.set(r,s(r));else{const s=e=>e.subject.isStopped||e.subject.value.args.some(e=>e instanceof Array?e.some(s):s(e));s(r)||e.next(["unsubscribe",{id:this.map.find(r)}]),t.get(r).unsubscribe(),t.delete(r)}}))}),this.ref=e=>({id:this.map.find(e)}),this.checkTypes=(e,...t)=>{const r=()=>new Error("Type Mismatch : "+e.key+" not in "+JSON.stringify(h(t[0],e=>e instanceof Array?e[0]:e)));if(1===t.length){if(t[0].length&&!t[0].some(([t,r])=>e.handler===i.byKey(this.handlers,t)&&e.c===r))throw r()}else{const s=this.handlers;if(t[0].length&&!t[0].some(t=>e.handler===i.byKey(s,t)))throw r()}return e},this.getter=e=>{if(!("id"in e))throw new Error("There is no local context");return this.map.get(e.id)[0]},this.xderef=e=>(t,...r)=>this.checkTypes(e(t).origin,r),this.deref=e=>(t,...r)=>this.checkTypes(e(t).origin,r,0),this.emptyContext={deref:this.deref(this.getter),xderef:this.xderef(this.getter),ref:this.ref,...this.extra},this.callReturnRef=new WeakMap,this.functions=n}subscribeToLocals(){const e=new s.Subscription;return this.locals.forEach((t,r)=>e.add(this.push(r).subscription)),e}getNext(e){return void 0===e?`${this.prefix}${this.next++}`:e}findRef(e){const t=this.map.find(e);return"string"==typeof t?{id:t}:t}watch(e){const t=e.handlers();return this.changes.subscribe(e=>{switch(e[0]){case"next":return t.put(e[1]);case"error":return t.error(e[1],e[2]);case"complete":return t.complete(e[1]);case"unsubscribe":return t.unsubscribe(e[1])}})}_unserialize(e,t,r,s,n){var o,a,c;const u=i.byKey(this.handlers,e);if(void 0!==s[n])return s[n];const l=r[n],{id:d}=l;if(void 0===l.data)throw new Error("Trying to access a destructed object");const h=this.getNext(d),p=this.locals.get(null===(o=this.map.get(h))||void 0===o?void 0:o[0].origin);if(p&&!p.in)throw new Error("Unexpected serialized observable");const f=u.decode(t)(h,l.data,null!==(c=null===(a=this.get(h))||void 0===a?void 0:a[0])&&void 0!==c?c:null);if(void 0!==d){const e=this.map.get(d);if(void 0!==e){const t=e[0].origin;if(t.key!==l.type||t.c!==l.c)throw new Error("Trying to update a wrong type");t.subject.next(f);return{id:d,obs:t,subs:e[1].subscription}}}const b=this._insert(e,f,t,h,l.c);return s[n]={obs:b,id:h},s[n]}_insert(e,t,r,s,o){var a,c;const u=i.byKey(this.handlers,e),l=null===(a=u.compare)||void 0===a?void 0:a.call(u,r),d=new n.Destructable(this.handlers,e,o,t,l,null===(c=u.destroy)||void 0===c?void 0:c.call(u,r)(t.data),()=>this.map.delete(s));return this.map.set(s,[d,{}]),d}unserialize(e){const t=[],r=e instanceof Function?e(e=>({$:e})):e,s=e=>{const s=r[e],n=Object.assign(r,{[e]:s});return{...this._unserialize(s.type,o,n,t,e),m:s}},n=e=>"id"in e?this.map.get(e.id)[0]:s(e.$).obs,i=this.ref,o={deref:this.deref(n),ref:i,xderef:this.xderef(n),...this.extra},a=[],c=[];try{const e=h(r,({i:e},t)=>{e=t;const{obs:r,id:n,subs:i,m:o}=s(e),u=!1!==o.new;if(u&&void 0!==i)throw new Error("Trying to subscribe to an already subscribed entity");u?a.push(this.map.get(n)[1].subscription=r.subscribe(()=>{})):r.subject.isStopped||c.push(r.subscribe(()=>{}));return{id:n}});return c.forEach(e=>e.unsubscribe()),e}catch(e){throw c.concat(a).forEach(e=>e.unsubscribe()),e}}append(e,t,r){const s=this.getNext(),n=this._insert(e,t,this.emptyContext,s,r),i=this.map.get(s)[1].subscription=n.subscribe(()=>{});return{id:s,obs:n,subs:i}}push(e,{unload:t,nextId:r}={}){var s,n,i,o;const d=this.map.find(e.origin),h=this.getNext(null!==(o=null!==(i=null!=d?d:null===(n=null===(s=this.locals)||void 0===s?void 0:s.get(e.origin))||void 0===n?void 0:n.id)&&void 0!==i?i:this.map.usedId(e.origin))&&void 0!==o?o:null==r?void 0:r(e));let p,f=e;if(void 0===d){let s=!1;const n=[],i=()=>{n.forEach(e=>e.unsubscribe()),n.length=0};f=c.defineProperty(Object.assign(a.eagerCombineAll([e,e.origin.subject.pipe(l.alternMap(({args:e,n:t})=>{const s=e=>{const t=this.push(e,{nextId:r&&((e,t)=>r(e,null!=t?t:h))});return n.push(t.subscription),t.wrapped},i=2===t?e.map(e=>a.eagerCombineAll(e.map(s))):e.map(s);return a.eagerCombineAll(i)},{completeWithInner:!0}),u.tap(i))]).pipe(u.finalize(()=>{null==t||t({id:h});const r=this.locals.get(e.origin);r&&!r.out||(this.pushed.delete(e.origin),this.pushes.next([e.origin,!1])),i(),this.map.delete(h),s=!0}),u.map(([e])=>e),u.shareReplay({bufferSize:1,refCount:!0})),{origin:e.origin,parent:e}),"destroyed",{get:()=>s}),this.map.set(h,[f,{}]),p=f.subscribe();const o=this.locals.get(e.origin);o&&!o.out||(this.pushed.add(e.origin),this.pushes.next([e.origin,!0]))}else f=this.map.get(h)[0],p=f.subscribe();return{ref:{id:h},wrapped:f,subscription:p}}serialize(e,t){const{isNew:r,push:n=!0,ignore:i=[]}=t;return e.pipe(u.scan(t=>{const o=new p,c=new Map,u=new s.Subscription;let l=1;const d=e=>("id"in e?this.map.get(e.id):o.get(e.$))[0],h=e=>void 0!==this.map.find(e),f=s=>{const d=s.subject.value,p=a.current(s),f=this.map.find(s);if(void 0!==f&&-1!==i.indexOf(f))return{id:f};let y,g=void 0;if(void 0!==f&&t){const[,e]=t;g=e.get(s)}const m=g?{old:g.data}:{},v=()=>s.handler.encode(b)({...d,c:s.c,...m});if(g&&(y={data:v()},void 0===y.data&&void 0!==f))return c.set(s,g),{id:f};const _=o.find(s),x=null!=_?_:s===e?0:l++;if(void 0===_){y||(o.set(x,[s,null]),y={data:v()}),c.set(s,y);let e=f;if(void 0===e)if(n){const{subscription:t,ref:r}=this.push(s);u.add(t),e=r.id}else e=this.map.usedId(s);const i={type:s.key,value:p,...y,c:s.c,id:e};i.new=0===x&&null===t&&(r||!h(s)),o.set(x,[s,i])}return{$:x}},b={deref:this.deref(d),xderef:this.xderef(d),ref:f,...this.extra},y=[o,c,f(e),u];return null==t||t[3].unsubscribe(),y},null),u.map((function([e,,t,r]){this.add(r);const s=Array(e.size).fill(0).map((t,r)=>e.get(r));if(0===s.length){if("$"in t)throw new Error("Unexpected");return null}return s.map(([,e],t)=>{const r={i:t,...e};return delete r.value,r})})),u.filter(e=>null!==e))}get(e){return this.map.get(e)}getValue({id:e}){const t=this.get(e);if(void 0===t)throw new Error("Access to destroyed object");return t}local(e,t,r,n={}){if(null===this.functions)throw new Error("Cannot call local functions from remote store");const i=(0,this.functions[e])(t,this.getValue(r)[0]);return n.graph?new s.Observable(e=>{i.then(t=>{const{subscription:r}=this.push(t),s=this.serialize(t.origin,{isNew:!0,ignore:n.ignore});e.add(s.subscribe(e)),e.add(r)})}):new s.Observable(e=>{i.then(t=>{const{subscription:r,ref:s}=this.push(t);e.next(s),e.add(r)})})}remote(e,t,r,{handlers:n,serialized:i},o={}){return new s.Observable(a=>{const c=n(),{subscription:l,ref:h}=this.push(t,o.graph?{unload:e=>c.unsubscribe(e)}:{}),p=new s.Subscription,f=(e=>[new this.promiseCtr(t=>e=t),e])();if(o.graph){let e=i.get(t.origin);e||i.set(t.origin,e=this.serialize(t.origin,{isNew:!0}).pipe(d.asyncMap(e=>c.put(e).then(e=>({ok:!0,value:e[0]}))),u.tap({error:e=>c.error(h,e),complete:()=>c.complete(h)}),u.shareReplay({refCount:!0,bufferSize:1})));const r=e.subscribe();if(this.callReturnRef.set(a,f[0]),p.add(()=>{r.closed||r.unsubscribe()}),r.closed)return void p.unsubscribe()}p.add(l);const b=c.subscribeToResult({resp_id:e=>{b.add(this.getValue(e)[0].pipe(u.filter((e,t)=>0===t),u.mapTo(e)).subscribe(a)),f[1](e)},resp_call:e=>{var t;const r=this.unserialize(e)[0];b.add(null===(t=this.get(r.id))||void 0===t?void 0:t[1].subscription),f[1](r)},err_call:e=>f[0].then(t=>{this.getValue(t)[0].subject.error(e)}),comp_call:()=>f[0].then(e=>{this.getValue(e)[0].subject.complete()})});p.add(()=>{b.closed||c.end_call()}),p.add(b),b.add(p),c.call(e,r,h,o),o.graph&&f[0].then(e=>{const t=this.getValue(e)[0].subscribe(a);p.add(()=>t.unsubscribe())}),a.add(p)})}}},function(e,t){e.exports=i},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=t.wrapJson=t.JsonHandler=t.toArray=t.wrapArray=t.ArrayHandler=t.ArrayN=void 0;const n=r(3),i=r(6),o=r(2),a=s(r(14)),{depMap:c}=i.map;t.ArrayN=1,t.ArrayHandler=()=>({decode:({deref:e})=>(r,s)=>({args:s.map(t=>e(t)),data:null,n:t.ArrayN}),encode:({ref:e})=>({args:t})=>o.toCond(c(t,e)),ctr:(e,t,r,s)=>(s&&(s.splice(0),e=Object.assign(s,e)),e)}),t.wrapArray=e=>(r,...s)=>new n.Destructable(e,"Array",null,{data:null,args:r,n:t.ArrayN},void 0,...s),t.toArray=e=>t=>e(t,"Array");const u=(e,t)=>{const r=e=>Object.keys(e),s=new Set(r(e));for(const n of r(t)){s.delete(n);const r=e[n],i=t[n];r&&i&&"object"==typeof r&&"object"==typeof i&&Array.isArray(r)===Array.isArray(i)?u(r,i):e[n]=i}for(const t of s)delete e[t];return e},l=e=>null===e?e:e instanceof Array?e.map(l):"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,t])=>[e,l(t)])):e;t.JsonHandler=()=>({decode:()=>(e,t)=>({args:[],data:t,n:1}),encode:()=>({data:e,old:t})=>t&&a.default(e,t)?void 0:l(e),ctr:(e,t,r,s)=>s?u(s,t):t}),t.wrapJson=e=>(t,...r)=>new n.Destructable(e,"Json",null,{args:[],data:t,n:1},void 0,...r),t.toJson=e=>t=>e(t,"Json")},function(e,t){var r=Array.prototype.slice,s="function"==typeof Object.keys?Object.keys:function(e){var t=[];for(var r in e)t.push(r);return t},n=e.exports=function(e,t){return 0===e&&0===t?1/e==1/t:e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():a(e)?a(t):"object"!=typeof e&&"object"!=typeof t?e==t:function(e,t){if(i(e)||i(t))return!1;if(e.prototype!==t.prototype)return!1;if(o(e))return!!o(t)&&(e=r.call(e),t=r.call(t),n(e,t));try{var a,c,u=s(e),l=s(t)}catch(e){return!1}if(u.length!=l.length)return!1;for(u.sort(),l.sort(),c=u.length-1;c>=0;c--)if(u[c]!=l[c])return!1;for(c=u.length-1;c>=0;c--)if(a=u[c],!n(e[a],t[a]))return!1;return!0}(e,t))};function i(e){return null==e}function o(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function a(e){return"number"==typeof e&&e!=e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createProxy=t.createCallHandler=t.startListener=t.msg2to1keys=t.msg1to2keys=void 0;const s=r(0),n=r(5),i=r(9);t.msg1to2keys={call:0,complete:0,error:0,end_call:0,put:0,unsubscribe:0},t.msg2to1keys={call_complete:0,call_error:0,response_call:0,response_id:0,response_put:0},t.startListener=(e,t,r)=>t.subscribe((function({channel:s,type:i,data:o}){var a;switch(i){case"put":{const t=e.unserialize(JSON.parse(o));return r.next({channel:s,type:"response_put",data:JSON.stringify(t)})}case"unsubscribe":const i={id:JSON.parse(o)};return null===(a=e.getValue(i)[1].subscription)||void 0===a?void 0:a.unsubscribe();case"error":{const{id:t,msg:r}=JSON.parse(o),s={id:t},n=e.getValue(s)[0];if(!n)return;return n.subject.error(r)}case"complete":{const t={id:JSON.parse(o)},r=e.getValue(t)[0];if(!r)return;return r.subject.complete()}case"call":{const i=JSON.parse(o);i.ref={id:i.argId};const{fId:a,ref:c,opt:u,param:l}=i,d=t.pipe(n.filter(e=>e.channel===s&&"end_call"===e.type)).subscribe(()=>{p.unsubscribe()}),h={error:e=>r.next({channel:s,type:"call_error",data:JSON.stringify(e)}),complete:()=>r.next({channel:s,type:"call_complete",data:""})},p=u.graph?e.local(a,l,c,{...u,graph:!0}).subscribe({...h,next:e=>{r.next({channel:s,type:"response_call",data:JSON.stringify(e)})}}):e.local(a,l,c,{...u,graph:!1}).subscribe({...h,next:e=>{r.next({channel:s,type:"response_id",data:JSON.stringify(e.id)})}});return p.add(d),void this.add(p)}}})),t.createCallHandler=(e,r,s)=>({serialized:new WeakMap,handlers:()=>{const o=s[0]++;return{end_call:()=>e.next({channel:o,type:"end_call",data:""}),unsubscribe:t=>e.next({channel:o,data:JSON.stringify(t.id),type:"unsubscribe"}),put:t=>{const o=s[0]++,a=r.pipe(n.filter(e=>e.channel===o&&"response_put"===e.type),n.take(1)).toPromise(i.QuickPromise).then(e=>JSON.parse(e.data));return e.next({channel:o,type:"put",data:JSON.stringify(t)}),a},error:(t,r)=>e.next({channel:o,data:JSON.stringify({id:t.id,msg:""+r}),type:"error"}),complete:t=>e.next({channel:o,data:JSON.stringify(t.id),type:"complete"}),call:(t,r,s,n)=>e.next({channel:o,data:JSON.stringify({fId:t,param:r,argId:s.id,opt:n}),type:"call"}),subscribeToResult:e=>r.pipe(n.filter(e=>e.channel===o&&e.type in t.msg2to1keys)).subscribe((function({data:t,type:r}){"response_id"===r&&e.resp_id({id:JSON.parse(t)}),"response_call"===r&&e.resp_call(JSON.parse(t)),"call_error"===r&&(e.err_call(t).then(()=>this.unsubscribe()),this.unsubscribe()),"call_complete"===r&&e.comp_call().then(()=>this.unsubscribe())}))}}}),t.createProxy=(e,r,n,i)=>{const o=new s.Subscription,a=[0],c=t.createCallHandler(n,i,a);return o.add(t.startListener(r,n,i)),o.add(e.watch(c)),{channel:a,callHandler:c,subscription:o}}},function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var o=r(7);Object.defineProperty(t,"defineProperty",{enumerable:!0,get:function(){return o.defineProperty}}),t.guards=i(r(2));var a=r(9);Object.defineProperty(t,"QuickPromise",{enumerable:!0,get:function(){return a.QuickPromise}}),t.rx_utils=i(r(1))}])}));