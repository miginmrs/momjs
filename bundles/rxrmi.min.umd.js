!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("altern-map"),require("dependent-type"),require("rx-async"),require("rxjs/internal/observable/combineLatest"),require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define(["altern-map","dependent-type","rx-async","rxjs/internal/observable/combineLatest","rxjs/operators","rxjs"],t):"object"==typeof exports?exports.rxrmi=t(require("altern-map"),require("dependent-type"),require("rx-async"),require("rxjs/internal/observable/combineLatest"),require("rxjs/operators"),require("rxjs")):e.rxrmi=t(e["altern-map"],e["dependent-type"],e["rx-async"],e.rxjs.internal.observable.combineLatest,e.rxjs.operators,e.rxjs)}(self,(function(e,t,r,s,n,i){return o={385:e=>{var t=Array.prototype.slice,r="function"==typeof Object.keys?Object.keys:function(e){var t=[];for(var r in e)t.push(r);return t},s=e.exports=function(e,a){return 0===e&&0===a?1/e==1/a:e===a||(e instanceof Date&&a instanceof Date?e.getTime()===a.getTime():o(e)?o(a):"object"!=typeof e&&"object"!=typeof a?e==a:function(e,o){if(n(e)||n(o))return!1;if(e.prototype!==o.prototype)return!1;if(i(e))return!!i(o)&&(e=t.call(e),o=t.call(o),s(e,o));try{var a,c,u=r(e),l=r(o)}catch(e){return!1}if(u.length!=l.length)return!1;for(u.sort(),l.sort(),c=u.length-1;c>=0;c--)if(u[c]!=l[c])return!1;for(c=u.length-1;c>=0;c--)if(a=u[c],!s(e[a],o[a]))return!1;return!0}(e,a))};function n(e){return null==e}function i(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function o(e){return"number"==typeof e&&e!=e}},42:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asAsync=t.wait=t.runit=void 0,t.runit=(e,t)=>{const r=(...s)=>{const n=s.length?e.next(s[0]):e.next();return n.done?t.resolve(n.value):t.resolve(n.value).then(r)};return r()},t.wait=function*(e){return yield e},t.asAsync=function(e,r,s){return(...n)=>t.runit(e.call(s,...n),r)}},461:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BiMap=void 0;const s=r(318);t.BiMap=class{constructor(e=!1){this.watch=e,this.byId=new Map,this.byObs=new Map,this.oldId=new WeakMap,this._empty=new s.Subject,this.empty=new s.Observable((e=>{this.byId.size||e.next(),this._empty.subscribe(e)}))}get(e){return this.byId.get(e)}delete(e){const t=this.byId.get(e);t&&this.byObs.delete(t[0].origin);const r=this.byId.delete(e);return this.watch&&!this.byId.size&&this._empty.next(),r}set(e,t){if(this.byObs.has(t[0].origin))throw new Error("Object already in store");if(this.byId.has(e))throw new Error("Id already used");this.byObs.set(t[0].origin,e),this.oldId.set(t[0].origin,e),this.byId.set(e,t)}reuseId(e,t){this.oldId.set(e.origin,t)}finddir(e){const t=e.origin,r=this.byObs.get(t);if(void 0===r)return;const s=this.byId.get(r),n=s[0];let i=n,o=e;if(n===e)return[r,"exact"];const a=new Set([i]),c=new Set([o]);for(;;){const t=!c.add(o=o.parent)&&!a.add(i=i.parent);if(c.has(i)||a.has(o))return i===e?[r,"down"]:(o!==n&&(s[0]=o),[r,"up"]);if(t)throw new Error("Another observable with the same origin is in the store");o=o.parent,i=i.parent}}find(e,t=!1){var r;return t?this.byObs.get(e.origin):null===(r=this.finddir(e))||void 0===r?void 0:r[0]}usedId(e){return this.oldId.get(e.origin)}get size(){return this.byId.size}keys(){return this.byId.keys()}entries(){return this.byId.entries()}values(){return this.byId.values()}}},618:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transient=t.nodeps=void 0,t.nodeps=Symbol(),t.transient=Symbol()},693:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.array=void 0;const o=r(433),a=i(r(610)),{depMap:c}=o.map;var u;(u=t.array||(t.array={})).n=1,u.Handler=()=>({decode:({deref:e})=>(t,r)=>({args:c(r,(t=>e(t))),data:null,n:u.n}),encode:({ref:e})=>({args:t})=>c(t,(t=>e(t))),ctr:(e,t,r,s)=>(s&&(s.splice(0),e=Object.assign(s,e)),e)}),u.create=e=>(t,...r)=>new a.Origin(e,"Array",null,{data:null,args:t,n:u.n},void 0,...r),u.cast=e=>t=>e(t,"Array")},167:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},744:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(167),t),n(r(693),t),n(r(376),t),n(r(414),t),n(r(551),t)},376:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.json=void 0;const a=i(r(610)),c=o(r(385)),u=r(955);!function(e){e.n=1;const t=(e,r)=>{const s=e=>Object.keys(e),n=new Set(s(e));for(const i of s(r)){n.delete(i);const s=e[i],o=r[i];s&&o&&"object"==typeof s&&"object"==typeof o&&Array.isArray(s)===Array.isArray(o)?t(s,o):e[i]=o}for(const t of n)delete e[t];return e},r=e=>null===e?e:e instanceof Array?e.map(r):"object"==typeof e?Object.fromEntries(Object.entries(e).map((([e,t])=>[e,void 0===t?t:r(t)]))):e;e.Handler=()=>({decode:()=>(t,r)=>({args:[],data:r,n:e.n}),encode:()=>({data:e,old:t,c:s})=>null===s?t&&c.default(e,t)?void 0:r(e):e,ctr:(e,r,s,n)=>null===s&&null!==n?t(n,r):r}),e.create=t=>(r,...s)=>new a.Origin(t,"Json",u.toCond(null),{args:[],data:r,n:e.n},void 0,...s),e.cast=e=>t=>e(t,"Json")}(t.json||(t.json={}))},414:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.local=void 0;const o=i(r(610));var a;(a=t.local||(t.local={})).n=1,a.Handler=()=>({decode:()=>()=>({args:[],data:{},c:null,n:a.n}),encode:()=>()=>null,ctr:([],e)=>e}),a.create=e=>(t,...r)=>new o.Origin(e,"Local",null,{args:[],data:t,n:a.n},void 0,...r)},551:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDecode=t.getEncode=t.getCtr=void 0,t.getCtr=(e,t)=>e[t],t.getEncode=(e,t)=>e[t],t.getDecode=(e,t)=>e[t]},884:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.utils=t.altern_map=t.rx_async=void 0,t.rx_async=i(r(835)),t.altern_map=i(r(832)),t.utils=i(r(112)),o(r(618),t),o(r(722),t),o(r(42),t),o(r(610),t),o(r(862),t),o(r(186),t),o(r(461),t),o(r(279),t),o(r(958),t),o(r(744),t),o(r(874),t)},610:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Origin=t.compareEntries=void 0;const s=r(318),n=r(832),i=r(803),o=r(443);t.compareEntries=({compareData:e=((e,t)=>e===t),compareObs:t=((e,t)=>e===t)}={})=>(r,s)=>r.args.length===s.args.length&&r.args.every(((e,r)=>{const n=e,i=s.args[r];return n instanceof Array?i instanceof Array&&n.length===i.length&&n.every((e=>e===i[r])):!(i instanceof Array)&&t(n,i)}))&&e(r.data,s.data);class a extends s.Observable{constructor(e,r,a,c,{compare:u=t.compareEntries(),observer:l}={},...d){super(),this.getHandler=e,this.key=r,this.c=a,this.origin=this,this.parent=this;const h=this.handler=e(r);let p=c.data;this.subject=new s.BehaviorSubject(c),this.teardown=new s.Subscription,d.forEach(this.teardown.add.bind(this.teardown)),this.source=new s.Observable((e=>{e.add(this.teardown),e.add((()=>{var e;null===(e=h.destroy)||void 0===e||e.call(h,p),this.subject.isStopped?this.subject.closed=!0:this.subject.unsubscribe()}));const t=this.subject.pipe(o.distinctUntilChanged(u),n.alternMap((({args:e,data:t})=>i.eagerCombineAll(e.map((e=>e instanceof Array?i.eagerCombineAll(e):e))).pipe(o.map((e=>[e,t,a])))),{completeWithInner:!0,completeWithSource:!0}),o.tap({error:e=>this.subject.error(e),complete:()=>this.subject.complete()}),o.scan(((e,[t,r,s])=>h.ctr(t,p=r,s,e,this)),null));(l?o.tap(l(this))(t):t).subscribe(e)})),this.operator=o.shareReplay({bufferSize:1,refCount:!0})(this).operator}get destroyed(){return this.teardown.closed}add(e){return this.teardown.add(e)}static current(e,t){let r;return e.subscribe((e=>r=e)).unsubscribe(),r}}t.Origin=a},874:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createProxy=t.createCallHandler=t.startListener=t.msg2to1keys=t.msg1to2keys=void 0;const s=r(318),n=r(443),i=r(52);t.msg1to2keys={call:0,complete:0,error:0,end_call:0,put:0,unsubscribe:0,shutdown:0},t.msg2to1keys={call_complete:0,call_error:0,response_call:0,response_id:0,response_put:0,shutdown_ack:0},t.startListener=(e,t)=>r=>e.subscribe((function({channel:s,type:i,data:o}){var a;switch(i){case"put":{const e=r.unserialize(JSON.parse(o));return t.next({channel:s,type:"response_put",data:JSON.stringify(e)})}case"shutdown":return r.shutdown((e=>{t.next({channel:s,type:"shutdown_ack",data:""}),e()}));case"unsubscribe":{const e={id:JSON.parse(o)};return null===(a=r.getValue(e)[1].subscription)||void 0===a?void 0:a.unsubscribe()}case"error":{const{id:e,msg:t}=JSON.parse(o),s={id:e},n=r.getValue(s)[0];if(!n)return;return n.origin.subject.error(t)}case"complete":{const e={id:JSON.parse(o)},t=r.getValue(e)[0];if(!t)return;return t.origin.subject.complete()}case"call":{const i=JSON.parse(o);i.ref={id:i.argId};const{fId:a,ref:c,opt:u,param:l}=i,d=e.pipe(n.filter((e=>e.channel===s&&"end_call"===e.type))).subscribe((()=>p.unsubscribe())),h={error:e=>t.next({channel:s,type:"call_error",data:JSON.stringify(e)}),complete:()=>t.next({channel:s,type:"call_complete",data:""})},p=u.graph?r.call(a,l,c,{...u,graph:!0}).subscribe({...h,next:e=>t.next({channel:s,type:"response_call",data:JSON.stringify(e)})}):r.call(a,l,c,{...u,graph:!1}).subscribe({...h,next:e=>t.next({channel:s,type:"response_id",data:JSON.stringify(e.id)})});return p.add(d),void this.add(p)}}})),t.createCallHandler=(e,r,s)=>({serialized:new WeakMap,watch:()=>{const t=s[0]++;return{unsubscribe:r=>e.next({channel:t,data:JSON.stringify(r.id),type:"unsubscribe"}),put:t=>{const o=s[0]++,a=r.pipe(n.filter((e=>e.channel===o&&"response_put"===e.type)),n.take(1)).toPromise(i.QuickPromise).then((e=>JSON.parse(e.data)));return e.next({channel:o,type:"put",data:JSON.stringify(t)}),a},error:(r,s)=>e.next({channel:t,type:"error",data:JSON.stringify({id:r.id,msg:""+s})}),complete:r=>e.next({channel:t,type:"complete",data:JSON.stringify(r.id)}),shutdown:(s,i)=>{r.pipe(n.filter((e=>e.channel===t&&"shutdown_ack"===e.type)),n.take(1),s,n.mapTo(i)).subscribe(i),e.next({type:"shutdown",data:"",channel:t})}}},call:()=>{const i=s[0]++;return{call:(t,r,s,n)=>e.next({channel:i,type:"call",data:JSON.stringify({fId:t,param:r,argId:s.id,opt:n})}),end_call:()=>e.next({channel:i,type:"end_call",data:""}),subscribeToResult:e=>r.pipe(n.filter((e=>e.channel===i&&e.type in t.msg2to1keys))).subscribe((function({data:t,type:r}){"response_id"===r&&e.resp_id({id:JSON.parse(t)}),"response_call"===r&&e.resp_call(JSON.parse(t)),"call_error"===r&&(e.err_call(t).then((()=>this.unsubscribe())),this.unsubscribe()),"call_complete"===r&&e.comp_call().then((()=>this.unsubscribe()))}))}}}),t.createProxy=(e,r,n,i)=>{const o=new s.Subscription,a=[0],c=t.createCallHandler(n,i,a);return o.add(t.startListener(n,i)(r)),o.add(e.watch(c)),{channel:a,callHandler:c,subscription:o}}},958:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Store=void 0;const s=r(318),n=r(433),i=r(610),o=r(803),a=r(860),c=r(443),u=r(832),l=r(835),d=r(461),h=r(618),{depMap:p}=n.map,b=BigInt(1);t.Store=class{constructor({getHandler:e,callHandler:t,extra:r,functions:n,promiseCtr:i=Promise,name:o,prefix:a="",locals:u=[],base:l=!1,observe:h,notifier:f}){this.storeSubs=new s.Subscription,this.linkSubs=new s.Subscription,this.next=b,this.pushed=new Map,this._pushes=new s.Subject,this.pushes=this._pushes.asObservable(),this.changes=new s.Observable((e=>{const t=new Map;for(const[r,s]of this.pushed)t.set(r,this.linkTo(r,s,e));e.add(this.pushes.subscribe((([r,s,n])=>{if(n)t.set(r,this.linkTo(r,s,e));else{const n=e=>{const t=new Set([e]);for(;!t.has(e=e.parent);)t.add(e);if(!t.has(e.origin))return!1;const r=e.origin.subject;return!!r.isStopped||r.value.args.some((e=>e instanceof Array?e.some(n):n(e)))};n(r)||e.next(["unsubscribe",{id:s}]),t.get(r).unsubscribe(),t.delete(r)}})))})),this.addToObjects=e=>t=>null!==t&&"object"==typeof t&&this.objects.set(t,e),this.ref=e=>({id:this.map.find(e)}),this.checkTypes=(e,...t)=>{const r=e.origin,s=this.getHandler,n=()=>new Error("Type Mismatch : "+r.key+" not in "+JSON.stringify(p(t[0],(e=>e instanceof Array?e[0]:e))));if(1===t.length){if(t[0].length&&!t[0].some((([e,t])=>r.handler===s(e)&&r.c===t)))throw n()}else if(t[0].length&&!t[0].some((e=>r.handler===s(e))))throw n();return e},this.getter=e=>{if(!("id"in e))throw new Error("There is no local context");return this.getValue(e)[0]},this.xderef=e=>(t,...r)=>this.checkTypes(e(t),r),this.deref=e=>(t,...r)=>this.checkTypes(e(t),r,0),this.callReturnRef=new WeakMap,this.getHandler=e,this.callHandler=t,this.functions=n;const y=this.map=new d.BiMap(!0);this.empty=y.empty,this.extra=r,this.name=o,this.base=l,this.observe=h,this.prefix=a,this.notifier=null!=f?f:()=>y.empty.pipe(c.take(1)),this.promiseCtr=i,this.locals=new d.BiMap,this._emptyctx={deref:this.deref(this.getter),xderef:this.xderef(this.getter),ref:this.ref,...this.extra};for(const[e,{id:t,...r}]of u)this.locals.set(t,[e,r]);this.objects=new WeakMap}setup({local:e,listener:t}){this.linkSubs.add(this.watch(this.callHandler)),this.storeSubs.add(this.subscribeToLocals(e)),this.linkSubs.add(t(this))}add(e){return this.storeSubs.add(e)}shutdown(e){this.storeSubs.unsubscribe();const t=this.linkSubs;t.add(this.notifier().subscribe((()=>e(t.unsubscribe.bind(t)))))}remoteShutdown(e){this.storeSubs.unsubscribe();const t=this.linkSubs;this.callHandler.watch().shutdown(c.switchMapTo(this.notifier()),e(t.unsubscribe.bind(t)))}linkTo(e,t,r){const s=e.origin,n=s.handler.encode(this._emptyctx);return s.subject.pipe(c.scan(((e,t)=>{const r=s.c,i={...t,..."old"in e?{old:e.old}:{},c:r};return{old:n(i),params:i}}),{}),c.filter((({old:e})=>void 0!==e))).subscribe((({old:e,params:n})=>{r.next(["next",[{c:s.c,i:0,data:e,id:t,new:!("old"in(null!=n?n:{})),type:s.key}]])}),(e=>r.next(["error",{id:t},e])),(()=>r.next(["complete",{id:t}])))}subscribeToLocals(e){const t=new s.Subscription,r=null!=e?e:this.base?t:void 0;for(const[,[e,{local:s}]]of this.locals.entries())t.add(this.push(e,{local:null!=s?s:r}).subscription);return t}getNext(e){return void 0===e?`${this.prefix}${this.next++}`:e}watch(e){const t=e.watch();return this.changes.subscribe((e=>{switch(e[0]){case"next":return t.put(e[1]);case"error":return t.error(e[1],e[2]);case"complete":return t.complete(e[1]);case"unsubscribe":return t.unsubscribe(e[1])}}))}_unserialize(e,t,r,s,n){var i,o,a;const c=this.getHandler(e);if(void 0!==s[n])return s[n];const u=r[n],{id:l}=u;if(void 0===u.data)throw new Error("Trying to access a destructed object");const d=this.getNext(l),h=null===(i=this.locals.get(d))||void 0===i?void 0:i[1];if(h&&!h.in)throw new Error("Unexpected serialized observable");const p=c.decode(t)(d,u.data,null!==(a=null===(o=this.get(d))||void 0===o?void 0:o[0])&&void 0!==a?a:null);if(void 0!==l){const e=this.map.get(l);if(void 0!==e){const t=e[0].origin;if(t.key!==u.type||t.c!==u.c)throw new Error("Trying to update a wrong type");return t.subject.next(p),{id:l,obs:t,subs:e[1].subscription}}}const b=this._insert(e,p,t,d,u.c);return s[n]={obs:b,id:d},s[n]}_insert(e,t,r,s,n){var o;const a=this.getHandler,c=a(e),u=null===(o=c.compare)||void 0===o?void 0:o.call(c,r),l=this.observe,d=new i.Origin(a,e,n,t,{compare:u,observer:l&&!c[h.transient]?e=>({next:l(e)}):void 0},(()=>this.map.delete(s)));return this.map.set(s,[d,{}]),d}unserialize(e){const t=[],r=e instanceof Function?e((e=>({$:e}))):e,s=e=>{const s=r[e],n=Object.assign(r,{[e]:s});return{...this._unserialize(s.type,o,n,t,e),m:s}},n=e=>"id"in e?this.getValue(e)[0]:s(e.$).obs,i=this.ref,o={deref:this.deref(n),ref:i,xderef:this.xderef(n),...this.extra},a=[],c=[];try{const e=p(r,(({i:e},t)=>{e=t;const{obs:r,id:n,subs:i,m:o}=s(e),u=!1!==o.new;if(u&&void 0!==i)throw new Error("Trying to subscribe to an already subscribed entity");if(u){const e=this.map.get(n)[1];a.push(e.subscription=r.subscribe((()=>{}))),e.subscription.add((()=>e.subscription=void 0))}else r.subject.isStopped||c.push(r.subscribe((()=>{})));return{id:n}}));return c.forEach((e=>e.unsubscribe())),e}catch(e){throw c.concat(a).forEach((e=>e.unsubscribe())),e}}push(e,{unload:t,nextId:r,local:n}={}){var i,l,d,p;const b=this.map.finddir(e),f=this.getNext(null!==(d=null!==(l=null!==(i=null==b?void 0:b[0])&&void 0!==i?i:this.locals.find(e,!0))&&void 0!==l?l:this.map.usedId(e.origin))&&void 0!==d?d:null==r?void 0:r(e));let y,v=e;if(void 0===b){let i=!1;const l=[],d=function(){l.forEach(this.add.bind(this)),l.length=0},b=e.origin.subject.pipe(u.alternMap((({args:e,n:t})=>{const s=e=>{const t=this.push(e,{local:n,nextId:r&&((e,t)=>r(e,null!=t?t:f))});return l.push(t.subscription),t.wrapped},i=2===t?e.map((e=>o.eagerCombineAll(e.map(s)))):e.map(s);return o.eagerCombineAll(i)}),{completeWithInner:!0}),c.tap(d)),_=()=>{var r;null==t||t({id:f}),this.map.delete(f),i=!0;const n=null===(r=this.locals.get(f))||void 0===r?void 0:r[1];n&&!n.out||!this.pushed.delete(e)||this._pushes.next([e,f,!1]),d.call(s.Subscription.EMPTY)};!1!==(null==n?void 0:n.closed)?v=a.defineProperty(Object.assign(o.eagerCombineAll([e,b]).pipe(c.finalize(_),c.map((([e])=>e)),c.shareReplay({bufferSize:1,refCount:!0})),{origin:e.origin,parent:e}),"destroyed",{get:()=>i}):(n[h.nodeps]||n.add(b.subscribe((()=>{}))),n.add(_)),this.map.set(f,[v,{}]);const g=this.observe;y=v.subscribe(g&&!e.origin.handler[h.transient]?g(v):s.noop);const m=null===(p=this.locals.get(f))||void 0===p?void 0:p[1];y.closed||m&&!m.out||(this.pushed.set(e,f),this._pushes.next([e,f,!0]))}else"down"===b[1]&&(v=this.map.get(f)[0]),y=v.subscribe((()=>{}));return{ref:{id:f},wrapped:v,subscription:y}}serialize(e,t){const{isNew:r,push:n=!0,ignore:o=[]}=t,a=this;return e.pipe(c.scan((function(t){const c=new d.BiMap,u=new Map,l=new s.Subscription;let h=1;const p=e=>("id"in e?a.map.get(e.id):c.get(e.$))[0],b=s=>{const d=s.origin,p=s.origin.subject.value,b=i.Origin.current(s,this),y=a.map.find(s);if(void 0!==y&&-1!==o.indexOf(y))return{id:y};let v,_=void 0;if(void 0!==y&&t){const[,e]=t;_=e.get(s)}const g=_?{old:_.data}:{},m=()=>d.handler.encode(f)({...p,c:d.c,...g});if(_&&(v={data:m()},void 0===v.data&&void 0!==y))return u.set(s,_),{id:y};const j=c.find(s),O=null!=j?j:s===e?0:h++;if(void 0===j){v||(c.set(O,[s,null]),v={data:m()}),u.set(s,v);let e=y;if(void 0===e)if(n){const{subscription:t,ref:r}=a.push(s);l.add(t),e=r.id}else e=a.map.usedId(s);const i={type:d.key,value:b,...v,c:d.c,id:e};i.new=0===O&&null===t&&(r||(w=s,!(void 0!==a.map.find(w))));const o=c.get(O);o?o[1]=i:c.set(O,[s,i])}var w;return{$:O}},f={deref:a.deref(p),xderef:a.xderef(p),ref:b,...a.extra},y=[c,u,b(e),l];return null==t||t[3].unsubscribe(),y}),null),c.map((function([e,,t,r]){this.add(r);const s=Array(e.size).fill(0).map(((t,r)=>e.get(r)));if(0===s.length){if("$"in t)throw new Error("Unexpected");return null}return s.map((([,e],t)=>{const r={i:t,...e};return delete r.value,r}))})),c.filter((e=>null!==e)))}get(e){return this.map.get(e)}getValue({id:e}){const t=this.get(e);if(void 0===t)throw new Error("Access to destroyed object");return t}call(e,t,r,n={}){const i=this.functions[e],o=new s.Subscription,a=i(t,this.getValue(r)[0],o);return n.graph?new s.Observable((e=>{a.then((t=>{const{subscription:r}=this.push(t);r.add(o);const s=this.serialize(t.origin,{isNew:!0,ignore:n.ignore});e.add(s.subscribe(e)),e.add(r)}))})):new s.Observable((e=>{a.then((t=>{const{subscription:r,ref:s}=this.push(t);r.add(o),e.next(s),e.add(r)}))}))}remote(e,t,r,n={}){return new s.Observable((i=>{const{watch:o,call:a,serialized:u}=this.callHandler,d=o(),h=a(),{subscription:p,ref:b}=this.push(t,n.graph?{unload:e=>d.unsubscribe(e)}:{}),f=new s.Subscription,y=(e=>[new this.promiseCtr((t=>e=t)),e])();if(n.graph){let e=u.get(t);e||u.set(t,e=this.serialize(t,{isNew:!0}).pipe(l.asyncMap((e=>d.put(e).then((e=>({ok:!0,value:e[0]}))))),c.tap({error:e=>d.error(b,e),complete:()=>d.complete(b)}),c.shareReplay({refCount:!0,bufferSize:1})));const r=e.subscribe((()=>{}));if(this.callReturnRef.set(i,y[0]),f.add((()=>{r.closed||r.unsubscribe()})),r.closed)return void f.unsubscribe()}f.add(p);const v=h.subscribeToResult({resp_id:e=>{v.add(this.getValue(e)[0].pipe(c.filter(((e,t)=>0===t)),c.mapTo(e)).subscribe(i)),y[1](e)},resp_call:e=>{var t;const r=this.unserialize(e)[0];v.add(null===(t=this.get(r.id))||void 0===t?void 0:t[1].subscription),y[1](r)},err_call:e=>y[0].then((t=>{this.getValue(t)[0].subject.error(e)})),comp_call:()=>y[0].then((e=>{this.getValue(e)[0].subject.complete()}))});f.add((()=>{v.closed||h.end_call()})),f.add(v),v.add(f),h.call(e,r,b,n),n.graph&&y[0].then((e=>{const t=this.getValue(e)[0].subscribe(i);f.add(t)})),i.add(f)}))}}},722:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},279:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(618)},862:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(618)},825:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},88:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},349:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},186:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(269),t),n(r(88),t),n(r(349),t),n(r(825),t)},860:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineProperty=void 0,t.defineProperty=function(e,t,r){return Object.defineProperty(e,t,r)}},955:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toSuperKey=t.subKey=t.keys=t.byKey=t.asCond=t.toCond=void 0,t.toCond=e=>e,t.asCond=e=>e,t.byKey=(e,t)=>e[t],t.keys=e=>(t,r=e)=>r[t],t.subKey=e=>e,t.toSuperKey=e=>e},112:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.rx_utils=t.QuickPromise=t.guards=t.defineProperty=void 0;var o=r(860);Object.defineProperty(t,"defineProperty",{enumerable:!0,get:function(){return o.defineProperty}}),t.guards=i(r(955));var a=r(52);Object.defineProperty(t,"QuickPromise",{enumerable:!0,get:function(){return a.QuickPromise}}),t.rx_utils=i(r(803))},52:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickPromise=void 0;const r=e=>e;var s;!function(e){e[e.Pending=0]="Pending",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected",e[e.Alias=3]="Alias"}(s||(s={}));class n{constructor(e){this._thens=[],this._catchs=[],this._status=s.Pending,e((e=>{var t;if(this._status===s.Pending)if(null==(t=e)?void 0:t.then)this._status=s.Alias,this._promise=e,e.then(this._finilize(this._thens),this._finilize(this._catchs));else{const t=e;this._value=t,this._status=s.Resolved,this._finilize(this._thens)(t)}}),(e=>{this._status===s.Pending&&(this._error=e,this._status=s.Rejected,this._finilize(this._catchs)(e))}))}_finilize(e){return t=>{e.forEach((e=>e(t))),this._thens=[],this._catchs=[]}}_tryRun(e,t,r){return s=>{try{const i=e(s);(null==(n=i)?void 0:n.then)?i.then(t,r):t(i)}catch(e){r(e)}var n}}then(e,t){const i=null!=e?e:r;return new n(((e,r)=>{this._status===s.Pending?(this._thens.push(this._tryRun(i,e,r)),t?this._catchs.push(this._tryRun(t,e,r)):this._catchs.push(r)):this._status===s.Alias?this._promise.then(this._tryRun(i,e,r),t?this._tryRun(t,e,r):r):this._status===s.Resolved?this._tryRun(i,e,r)(this._value):t?this._tryRun(t,e,r)(this._error):r(this._error)}))}catch(e){return this.then(null,e)}finally(e){if(!e)return this;const t=()=>{try{e()}catch(e){}};return this._status===s.Alias?this._promise.then(t,t):this._status===s.Pending?(this._thens.push(t),this._catchs.push(t)):t(),this}static resolve(e){return new n((t=>t(e)))}static reject(e){return new n(((t,r)=>r(e)))}static all(e){const t=e instanceof Array?[...e]:{...e},r=Object.keys(e).filter((t=>e[t].then));let s=r.length;return new n(((n,i)=>{s||n(t),r.forEach((r=>{e[r].then((e=>{t[r]=e,--s||n(t)}),i)}))}))}}t.QuickPromise=n},803:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.current=t.eagerCombineAll=void 0;const s=r(318),n=r(122);class i extends s.Subscriber{notifyComplete(){var e,t;null===(t=(e=this.destination).complete)||void 0===t||t.call(e)}}t.eagerCombineAll=function(...e){if(0===e.length||1===e.length&&e[0]instanceof Array&&0===e[0].length)return s.concat(s.of([]),s.NEVER);const t=s.combineLatest.apply(this,e);return t.operator.call=function(e,t){n.CombineLatestOperator.prototype.call(e,t).notifyComplete=i.prototype.notifyComplete},t},t.current=function(e,t){return e.subscribe((e=>t=e)).unsubscribe(),t}},832:t=>{"use strict";t.exports=e},433:e=>{"use strict";e.exports=t},835:e=>{"use strict";e.exports=r},122:e=>{"use strict";e.exports=s},443:e=>{"use strict";e.exports=n},318:e=>{"use strict";e.exports=i}},a={},function e(t){if(a[t])return a[t].exports;var r=a[t]={exports:{}};return o[t].call(r.exports,r,r.exports,e),r.exports}(884);var o,a}));