!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs"),require("rxjs/operators"),require("rxjs/internal/OuterSubscriber"),require("rxjs/internal/InnerSubscriber"),require("rxjs/internal/util/subscribeToResult"),require("rxjs/internal/observable/combineLatest")):"function"==typeof define&&define.amd?define(["rxjs","rxjs/operators","rxjs/internal/OuterSubscriber","rxjs/internal/InnerSubscriber","rxjs/internal/util/subscribeToResult","rxjs/internal/observable/combineLatest"],t):"object"==typeof exports?exports.rxrmi=t(require("rxjs"),require("rxjs/operators"),require("rxjs/internal/OuterSubscriber"),require("rxjs/internal/InnerSubscriber"),require("rxjs/internal/util/subscribeToResult"),require("rxjs/internal/observable/combineLatest")):e.rxrmi=t(e.rxjs,e.rxjs.operators,e.rxjs.internal.OuterSubscriber,e.rxjs.internal.InnerSubscriber,e.rxjs.internal.util.subscribeToResult,e.rxjs.internal.observable.combineLatest)}(self,(function(e,t,r,n,i,s){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=11)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Origin=t.compareEntries=void 0;const n=r(0),i=r(3),s=r(4),o=r(2);t.compareEntries=({compareData:e=((e,t)=>e===t),compareObs:t=((e,t)=>e===t)}={})=>(r,n)=>r.args.length===n.args.length&&r.args.every((e,r)=>{const i=e,s=n.args[r];return i instanceof Array?s instanceof Array&&(i.length===s.length&&i.every(e=>e===s[r])):!(s instanceof Array)&&t(i,s)})&&e(r.data,n.data);class a extends n.Observable{constructor(e,r,a,c,u=t.compareEntries(),...l){super(),this.getHandler=e,this.key=r,this.c=a,this.origin=this,this.parent=this;const d=this.handler=e(r);let h=c.data;this.subject=new n.BehaviorSubject(c),this.teardown=new n.Subscription,l.forEach(this.teardown.add.bind(this.teardown)),this.source=new n.Observable(e=>{e.add(this.teardown),e.add(()=>{var e;null===(e=d.destroy)||void 0===e||e.call(d,h),this.subject.isStopped?this.subject.closed=!0:this.subject.unsubscribe()}),this.subject.pipe(o.distinctUntilChanged(u),i.alternMap(({args:e,data:t})=>s.eagerCombineAll(e.map(e=>e instanceof Array?s.eagerCombineAll(e):e)).pipe(o.map(e=>[e,t,a])),{completeWithInner:!0,completeWithSource:!0}),o.tap({error:e=>this.subject.error(e),complete:()=>this.subject.complete()}),o.scan((e,[t,r,n])=>d.ctr(t,h=r,n,e,this),null)).subscribe(e)}),this.operator=o.shareReplay({bufferSize:1,refCount:!0})(this).operator}get destroyed(){return this.teardown.closed}add(e){return this.teardown.add(e)}}t.Origin=a},function(e,r){e.exports=t},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(13),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.current=t.on=t.eagerCombineAll=void 0;const n=r(0),i=r(19);class s extends n.Subscriber{notifyComplete(){var e,t;null===(t=(e=this.destination).complete)||void 0===t||t.call(e)}}t.eagerCombineAll=function(...e){if(0===e.length||1===e.length&&e[0]instanceof Array&&0===e[0].length)return n.concat(n.of([]),n.NEVER);const t=n.combineLatest.apply(this,e);return t.operator.call=function(e,t){i.CombineLatestOperator.prototype.call(e,t).notifyComplete=s.prototype.notifyComplete},t},t.on=({complete:e,error:t,next:r,subscribe:i,teardown:s})=>o=>o.lift((function(o){const a=this;null==i||i();const c=new n.Subscription;return c.add(o.subscribe(e=>{null==r||r(e),a.next(e)},e=>{null==t||t(e),a.error(e)},()=>{null==e||e(),a.complete()})),c.add(s),c})),t.current=function(e,t){return e.subscribe(e=>t=e).unsubscribe(),t}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(12),t),i(r(6),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.List=void 0;class n{*iterator(e=this.head){for(;e;)yield e,e=e.next}[Symbol.iterator](){return this.iterator()}unshift(e){const t=this.head,r=this.head={value:e,next:t,list:this};return t&&(t.prev=this.head),this.tail||(this.tail=this.head),r}remove(e){this.head===e&&(this.head=e.next),this.tail===e&&(this.tail=e.prev),e.next&&(e.next.prev=e.prev,e.next=void 0),e.prev&&(e.prev.next=e.next,e.prev=void 0)}}t.List=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineProperty=void 0,t.defineProperty=function(e,t,r){return Object.defineProperty(e,t,r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickPromise=void 0;const n=e=>e;var i;!function(e){e[e.Pending=0]="Pending",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected",e[e.Alias=3]="Alias"}(i||(i={}));class s{constructor(e){this._thens=[],this._catchs=[],this._status=i.Pending,e(e=>{var t;if(this._status===i.Pending)if(null==(t=e)?void 0:t.then)this._status=i.Alias,this._promise=e,e.then(this._finilize(this._thens),this._finilize(this._catchs));else{const t=e;this._value=t,this._status=i.Resolved,this._finilize(this._thens)(t)}},e=>{this._status===i.Pending&&(this._error=e,this._status=i.Rejected,this._finilize(this._catchs)(e))})}_finilize(e){return t=>{e.forEach(e=>e(t)),this._thens=[],this._catchs=[]}}_tryRun(e,t,r){return n=>{try{const s=e(n);if(null==(i=s)?void 0:i.then)s.then(t,r);else{t(s)}}catch(e){r(e)}var i}}then(e,t){const r=null!=e?e:n;return new s((e,n)=>{if(this._status===i.Pending)this._thens.push(this._tryRun(r,e,n)),t?this._catchs.push(this._tryRun(t,e,n)):this._catchs.push(n);else if(this._status===i.Alias){this._promise.then(this._tryRun(r,e,n),t?this._tryRun(t,e,n):n)}else this._status===i.Resolved?this._tryRun(r,e,n)(this._value):t?this._tryRun(t,e,n)(this._error):n(this._error)})}catch(e){return this.then(null,e)}finally(e){if(!e)return this;const t=()=>{try{e()}catch(e){}};return this._status===i.Alias?this._promise.then(t,t):this._status===i.Pending?(this._thens.push(t),this._catchs.push(t)):t(),this}static resolve(e){return new s(t=>t(e))}static reject(e){return new s((t,r)=>r(e))}static all(e){const t=e instanceof Array?[...e]:{...e},r=Object.keys(e).filter(t=>e[t].then);let n=r.length;return new s((i,s)=>{n||i(t),r.forEach(r=>{e[r].then(e=>{t[r]=e,--n||i(t)},s)})})}}t.QuickPromise=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BiMap=void 0;const n=r(0);t.BiMap=class{constructor(e=!1){this.watch=e,this.byId=new Map,this.byObs=new Map,this.oldId=new WeakMap,this._empty=new n.Subject,this.empty=new n.Observable(e=>{this.byId.size||e.next(),this._empty.subscribe(e)})}get(e){return this.byId.get(e)}delete(e){const t=this.byId.get(e);t&&this.byObs.delete(t[0].origin);const r=this.byId.delete(e);return this.watch&&!this.byId.size&&this._empty.next(),r}set(e,t){if(this.byObs.has(t[0].origin))throw new Error("Object already in store");if(this.byId.has(e))throw new Error("Id already used");this.byObs.set(t[0].origin,e),this.oldId.set(t[0].origin,e),this.byId.set(e,t)}reuseId(e,t){this.oldId.set(e.origin,t)}finddir(e){const t=e.origin,r=this.byObs.get(t);if(void 0===r)return;const n=this.byId.get(r)[0];let i=n,s=e;if(n===e)return[r,"exact"];const o=new Set([i]),a=new Set([s]),c=new Error("Another observable with the same origin is in the store");for(;;){const t=!a.add(s=s.parent)&&!o.add(i=i.parent);if(a.has(i)||o.has(s)){if(i===e)return[r,"down"];if(s===n)return[r,"up"];throw c}if(t)throw c;s=s.parent,i=i.parent}}find(e,t=!1){var r;return t?this.byObs.get(e.origin):null===(r=this.finddir(e))||void 0===r?void 0:r[0]}usedId(e){return this.oldId.get(e.origin)}get size(){return this.byId.size}keys(){return this.byId.keys()}entries(){return this.byId.entries()}values(){return this.byId.values()}}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.map=void 0,t.map=s(r(30))},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.utils=t.altern_map=t.rx_async=void 0,t.rx_async=s(r(5)),t.altern_map=s(r(3)),t.utils=s(r(17)),o(r(20),t),o(r(21),t),o(r(1),t),o(r(22),t),o(r(23),t),o(r(9),t),o(r(28),t),o(r(29),t),o(r(31),t),o(r(37),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.iterateMap=t.asyncMap=t.iterate=void 0;const n=r(0),i=r(6);t.iterate=async(e,t,r)=>{let i=!1,s=await e.next();for(r&&r(()=>{i=!0,e.next(!0).catch(n.noop)});!i&&!s.done;){const r=t&&t();r?await r:s=await e.next(!1)}return!i&&s.done?{ok:!0,value:s.value}:{}},t.asyncMap=(e,{handleException:t,wait:r=!1,mode:s="concurrent"}={})=>o=>new n.Observable(a=>{let c=n.Subscription.EMPTY;const u="merge"===s,l="recent"===s,d=new i.List,h=!u&&!l,p="switch"===s,f=new WeakMap,b=new WeakMap,y=o.subscribe({next:r=>{const i=c,s=c=new n.Subscription,o=d.unshift();f.set(o,new Promise(e=>b.set(o,e))),s.add(()=>d.remove(o));const l=e(r,o,{get closed(){return s.closed}},()=>h&&o.next?f.get(o.next):void 0,e=>s.add(e)).then(void 0,e=>({ok:!1,error:e}));if(s.add(n.from(l).subscribe(({ok:e,value:r,error:n})=>{if(!e){if(n&&t){const e=t(n);e.ok&&a.next(e.value)}return d.remove(o),b.get(o)(),i.add(s)}a.next(r),u?i.add(s):s.unsubscribe()})),p)return i.unsubscribe();s.add(i)},error:e=>a.error(e),complete:()=>c.add(()=>a.complete())}),v=r?new n.Subscription:y;return r&&v.add(y),v.add(()=>c.unsubscribe()),v}),t.iterateMap=(e,r={mode:"concurrent"})=>t.asyncMap((r,n,i,s,o)=>t.iterate(e(r,n,i),s,o),r)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.alternMap=void 0;const n=r(0),i=r(2),s=r(14),o=r(15),a=r(16);t.alternMap=function e(t,r,s){return"function"==typeof s?o=>o.pipe(e((e,r)=>n.from(t(e,r)).pipe(i.map((t,n)=>s(e,t,r,n))),r)):e=>e.lift(new c(t,r||{}))};class c{constructor(e,t){this.project=e,this.options=t}call(e,t){return t.subscribe(new u(e,this.project,this.options))}}class u extends s.OuterSubscriber{constructor(e,t,r){super(e),this.project=t,this.options=r,this.index=0}_next(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this._innerSub(t,e,r)}_innerSub(e,t,r){const n=this.innerSubscription,i=new o.InnerSubscriber(this,t,r),s=this.destination;s.add(i),this.innerSubscription=a.subscribeToResult(this,e,void 0,void 0,i),this.innerSubscription!==i&&s.add(this.innerSubscription),n&&n.unsubscribe()}_complete(){const{innerSubscription:e}=this;(!e||e.closed||this.options.completeWithSource)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=null}notifyComplete(e){this.destination.remove(e),this.innerSubscription=null,(this.isStopped||this.options.completeWithInner)&&super._complete()}notifyNext(e,t,r,n,i){this.destination.next(t)}}},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.rx_utils=t.QuickPromise=t.guards=t.defineProperty=void 0;var o=r(7);Object.defineProperty(t,"defineProperty",{enumerable:!0,get:function(){return o.defineProperty}}),t.guards=s(r(18));var a=r(8);Object.defineProperty(t,"QuickPromise",{enumerable:!0,get:function(){return a.QuickPromise}}),t.rx_utils=s(r(4))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toSuperKey=t.subKey=t.keys=t.byKey=t.asCond=t.toCond=void 0,t.toCond=e=>e,t.asCond=e=>e,t.byKey=(e,t)=>e[t],t.keys=e=>(t,r=e)=>r[t],t.subKey=e=>e,t.toSuperKey=e=>e},function(e,t){e.exports=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asAsync=t.wait=t.runit=void 0,t.runit=(e,t)=>{const r=(...n)=>{const i=n.length?e.next(n[0]):e.next();return i.done?t.resolve(i.value):t.resolve(i.value).then(r)};return r()},t.wait=function*(e){return yield e},t.asAsync=function(e,r,n){return(...i)=>t.runit(e.call(n,...i),r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(24),t),i(r(25),t),i(r(26),t),i(r(27),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Store=void 0;const n=r(0),i=r(10),s=r(1),o=r(4),a=r(7),c=r(2),u=r(3),l=r(5),d=r(9),{depMap:h}=i.map,p=BigInt(1);class f{constructor(e,t,r,i=null,s,o="",a=[],u=!1){this.getHandler=e,this.extra=t,this.promiseCtr=r,this.functions=i,this.name=s,this.prefix=o,this.base=u,this.next=p,this.pushed=new Map,this.pushes=new n.Subject,this.changes=new n.Observable(e=>{const t=new Map,r=this.emptyContext,n=(t,n)=>{const i=t.origin,s=i.handler.encode(r);return i.subject.pipe(c.scan((e,t)=>{const r=i.c,n={...t,..."old"in e?{old:e.old}:{},c:r};return{old:s(n),params:n}},{}),c.filter(({old:e})=>void 0!==e)).subscribe(({old:t,params:r})=>{e.next(["next",[{c:i.c,i:0,data:t,id:n,new:!("old"in(null!=r?r:{})),type:i.key}]])},t=>e.next(["error",{id:n},t]),()=>e.next(["complete",{id:n}]))};for(const[e,r]of this.pushed)t.set(e,n(e,r));e.add(this.pushes.subscribe(([r,i,s])=>{if(s)t.set(r,n(r,i));else{const n=e=>{const t=new Set([e]);for(;!t.has(e=e.parent);)t.add(e);if(!t.has(e.origin))return!1;const r=e.origin.subject;return!!r.isStopped||r.value.args.some(e=>e instanceof Array?e.some(n):n(e))};n(r)||e.next(["unsubscribe",{id:i}]),t.get(r).unsubscribe(),t.delete(r)}}))}),this.ref=e=>({id:this.map.find(e)}),this.checkTypes=(e,...t)=>{const r=e.origin,n=this.getHandler,i=()=>new Error("Type Mismatch : "+r.key+" not in "+JSON.stringify(h(t[0],e=>e instanceof Array?e[0]:e)));if(1===t.length){if(t[0].length&&!t[0].some(([e,t])=>r.handler===n(e)&&r.c===t))throw i()}else if(t[0].length&&!t[0].some(e=>r.handler===n(e)))throw i();return e},this.getter=e=>{if(!("id"in e))throw new Error("There is no local context");return this.getValue(e)[0]},this.xderef=e=>(t,...r)=>this.checkTypes(e(t),r),this.deref=e=>(t,...r)=>this.checkTypes(e(t),r,0),this.emptyContext={deref:this.deref(this.getter),xderef:this.xderef(this.getter),ref:this.ref,...this.extra},this.callReturnRef=new WeakMap,this.functions=i;const l=this.map=new d.BiMap(!0);this.empty=l.empty,this.locals=new d.BiMap;for(const[e,{id:t,...r}]of a)this.locals.set(t,[e,r])}subscribeToLocals(e){const t=new n.Subscription,r=null!=e?e:this.base?t:void 0;for(const[,[e,{local:n}]]of this.locals.entries())t.add(this.push(e,{local:null!=n?n:r}).subscription);return t}getNext(e){return void 0===e?`${this.prefix}${this.next++}`:e}watch(e){const t=e.handlers();return this.changes.subscribe(e=>{switch(e[0]){case"next":return t.put(e[1]);case"error":return t.error(e[1],e[2]);case"complete":return t.complete(e[1]);case"unsubscribe":return t.unsubscribe(e[1])}})}_unserialize(e,t,r,n,i){var s,o,a;const c=this.getHandler(e);if(void 0!==n[i])return n[i];const u=r[i],{id:l}=u;if(void 0===u.data)throw new Error("Trying to access a destructed object");const d=this.getNext(l),h=null===(s=this.locals.get(d))||void 0===s?void 0:s[1];if(h&&!h.in)throw new Error("Unexpected serialized observable");const p=c.decode(t)(d,u.data,null!==(a=null===(o=this.get(d))||void 0===o?void 0:o[0])&&void 0!==a?a:null);if(void 0!==l){const e=this.map.get(l);if(void 0!==e){const t=e[0].origin;if(t.key!==u.type||t.c!==u.c)throw new Error("Trying to update a wrong type");t.subject.next(p);return{id:l,obs:t,subs:e[1].subscription}}}const f=this._insert(e,p,t,d,u.c);return n[i]={obs:f,id:d},n[i]}_insert(e,t,r,n,i){var o;const a=this.getHandler,c=a(e),u=null===(o=c.compare)||void 0===o?void 0:o.call(c,r),l=new s.Origin(a,e,i,t,u,()=>this.map.delete(n));return this.map.set(n,[l,{}]),l}unserialize(e){const t=[],r=e instanceof Function?e(e=>({$:e})):e,n=e=>{const n=r[e],i=Object.assign(r,{[e]:n});return{...this._unserialize(n.type,o,i,t,e),m:n}},i=e=>"id"in e?this.getValue(e)[0]:n(e.$).obs,s=this.ref,o={deref:this.deref(i),ref:s,xderef:this.xderef(i),...this.extra},a=[],c=[];try{const e=h(r,({i:e},t)=>{e=t;const{obs:r,id:i,subs:s,m:o}=n(e),u=!1!==o.new;if(u&&void 0!==s)throw new Error("Trying to subscribe to an already subscribed entity");if(u){const e=this.map.get(i)[1];a.push(e.subscription=r.subscribe(()=>{})),e.subscription.add(()=>e.subscription=void 0)}else r.subject.isStopped||c.push(r.subscribe(()=>{}));return{id:i}});return c.forEach(e=>e.unsubscribe()),e}catch(e){throw c.concat(a).forEach(e=>e.unsubscribe()),e}}append(e,t,r){const n=this.getNext(),i=this._insert(e,t,this.emptyContext,n,r),s=this.map.get(n)[1].subscription=i.subscribe(()=>{});return{id:n,obs:i,subs:s}}push(e,{unload:t,nextId:r,local:i}={}){var s,l,d,h;const p=this.map.finddir(e),b=this.getNext(null!==(d=null!==(l=null!==(s=null==p?void 0:p[0])&&void 0!==s?s:this.locals.find(e,!0))&&void 0!==l?l:this.map.usedId(e.origin))&&void 0!==d?d:null==r?void 0:r(e));let y,v=e;if(void 0===p){let s=!1;const l=[],d=function(){l.forEach(this.add.bind(this)),l.length=0},p=e.origin.subject.pipe(u.alternMap(({args:e,n:t})=>{const n=e=>{const t=this.push(e,{local:i,nextId:r&&((e,t)=>r(e,null!=t?t:b))});return l.push(t.subscription),t.wrapped},s=2===t?e.map(e=>o.eagerCombineAll(e.map(n))):e.map(n);return o.eagerCombineAll(s)},{completeWithInner:!0}),c.tap(d)),_=()=>{var r;null==t||t({id:b}),this.map.delete(b),s=!0;const i=null===(r=this.locals.get(b))||void 0===r?void 0:r[1];i&&!i.out||!this.pushed.delete(e)||this.pushes.next([e,b,!1]),d.call(n.Subscription.EMPTY)};!1!==(null==i?void 0:i.closed)?(v=a.defineProperty(Object.assign(o.eagerCombineAll([e,p]).pipe(c.finalize(_),c.map(([e])=>e),c.shareReplay({bufferSize:1,refCount:!0})),{origin:e.origin,parent:e}),"destroyed",{get:()=>s}),this.map.set(b,[v,{}]),y=v.subscribe(()=>{})):(i[f.nodeps]||i.add(p.subscribe(()=>{})),i.add(_),this.map.set(b,[v,{}]),y=v.subscribe(()=>{}));const g=null===(h=this.locals.get(b))||void 0===h?void 0:h[1];g&&!g.out||(this.pushed.set(e,b),this.pushes.next([e,b,!0]))}else"down"===p[1]&&(v=this.map.get(b)[0]),y=v.subscribe(()=>{});return{ref:{id:b},wrapped:v,subscription:y}}serialize(e,t){const{isNew:r,push:i=!0,ignore:s=[]}=t;return e.pipe(c.scan(t=>{const a=new d.BiMap,c=new Map,u=new n.Subscription;let l=1;const h=e=>("id"in e?this.map.get(e.id):a.get(e.$))[0],p=e=>void 0!==this.map.find(e),f=n=>{const d=n.origin,h=n.origin.subject.value,f=o.current(n),y=this.map.find(n);if(void 0!==y&&-1!==s.indexOf(y))return{id:y};let v,_=void 0;if(void 0!==y&&t){const[,e]=t;_=e.get(n)}const g=_?{old:_.data}:{},m=()=>d.handler.encode(b)({...h,c:d.c,...g});if(_&&(v={data:m()},void 0===v.data&&void 0!==y))return c.set(n,_),{id:y};const j=a.find(n),O=null!=j?j:n===e?0:l++;if(void 0===j){v||(a.set(O,[n,null]),v={data:m()}),c.set(n,v);let e=y;if(void 0===e)if(i){const{subscription:t,ref:r}=this.push(n);u.add(t),e=r.id}else e=this.map.usedId(n);const s={type:d.key,value:f,...v,c:d.c,id:e};s.new=0===O&&null===t&&(r||!p(n));const o=a.get(O);o?o[1]=s:a.set(O,[n,s])}return{$:O}},b={deref:this.deref(h),xderef:this.xderef(h),ref:f,...this.extra},y=[a,c,f(e),u];return null==t||t[3].unsubscribe(),y},null),c.map((function([e,,t,r]){this.add(r);const n=Array(e.size).fill(0).map((t,r)=>e.get(r));if(0===n.length){if("$"in t)throw new Error("Unexpected");return null}return n.map(([,e],t)=>{const r={i:t,...e};return delete r.value,r})})),c.filter(e=>null!==e))}get(e){return this.map.get(e)}getValue({id:e}){const t=this.get(e);if(void 0===t)throw new Error("Access to destroyed object");return t}call(e,t,r,i={}){if(null===this.functions)throw new Error("Cannot call local functions from remote store");const s=this.functions[e],o=new n.Subscription,a=s(t,this.getValue(r)[0],o);return i.graph?new n.Observable(e=>{a.then(t=>{const{subscription:r}=this.push(t);r.add(o);const n=this.serialize(t.origin,{isNew:!0,ignore:i.ignore});e.add(n.subscribe(e)),e.add(r)})}):new n.Observable(e=>{a.then(t=>{const{subscription:r,ref:n}=this.push(t);r.add(o),e.next(n),e.add(r)})})}remote(e,t,r,{handlers:i,serialized:s},o={}){return new n.Observable(a=>{const u=i(),{subscription:d,ref:h}=this.push(t,o.graph?{unload:e=>u.unsubscribe(e)}:{}),p=new n.Subscription,f=(e=>[new this.promiseCtr(t=>e=t),e])();if(o.graph){let e=s.get(t);e||s.set(t,e=this.serialize(t,{isNew:!0}).pipe(l.asyncMap(e=>u.put(e).then(e=>({ok:!0,value:e[0]}))),c.tap({error:e=>u.error(h,e),complete:()=>u.complete(h)}),c.shareReplay({refCount:!0,bufferSize:1})));const r=e.subscribe(()=>{});if(this.callReturnRef.set(a,f[0]),p.add(()=>{r.closed||r.unsubscribe()}),r.closed)return void p.unsubscribe()}p.add(d);const b=u.subscribeToResult({resp_id:e=>{b.add(this.getValue(e)[0].pipe(c.filter((e,t)=>0===t),c.mapTo(e)).subscribe(a)),f[1](e)},resp_call:e=>{var t;const r=this.unserialize(e)[0];b.add(null===(t=this.get(r.id))||void 0===t?void 0:t[1].subscription),f[1](r)},err_call:e=>f[0].then(t=>{this.getValue(t)[0].subject.error(e)}),comp_call:()=>f[0].then(e=>{this.getValue(e)[0].subject.complete()})});p.add(()=>{b.closed||u.end_call()}),p.add(b),b.add(p),u.call(e,r,h,o),o.graph&&f[0].then(e=>{const t=this.getValue(e)[0].subscribe(a);p.add(t)}),a.add(p)})}}t.Store=f,f.nodeps=Symbol()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncDepMap=t.depMap=t.conf=void 0,t.conf={Promise:Promise},t.depMap=(e,t)=>{const r=[];return e.forEach((e,n)=>r[n]=t(e,n)),r},t.asyncDepMap=(e,r,n=t.conf.Promise)=>{const i=[];return n.all(e.map((e,t)=>n.resolve(r(e,t)).then(e=>i[t]=e))).then(()=>i)}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(32),t),i(r(33),t),i(r(34),t),i(r(36),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.array=void 0;const o=r(10),a=s(r(1)),{depMap:c}=o.map;!function(e){e.n=1,e.Handler=()=>({decode:({deref:t})=>(r,n)=>({args:c(n,e=>t(e)),data:null,n:e.n}),encode:({ref:e})=>({args:t})=>c(t,t=>e(t)),ctr:(e,t,r,n)=>(n&&(n.splice(0),e=Object.assign(n,e)),e)}),e.create=t=>(r,...n)=>new a.Origin(t,"Array",null,{data:null,args:r,n:e.n},void 0,...n),e.cast=e=>t=>e(t,"Array")}(t.array||(t.array={}))},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.json=void 0;const a=s(r(1)),c=o(r(35));!function(e){e.n=1;const t=(e,r)=>{const n=e=>Object.keys(e),i=new Set(n(e));for(const s of n(r)){i.delete(s);const n=e[s],o=r[s];n&&o&&"object"==typeof n&&"object"==typeof o&&Array.isArray(n)===Array.isArray(o)?t(n,o):e[s]=o}for(const t of i)delete e[t];return e},r=e=>null===e?e:e instanceof Array?e.map(r):"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,t])=>[e,r(t)])):e;e.Handler=()=>({decode:()=>(t,r)=>({args:[],data:r,n:e.n}),encode:()=>({data:e,old:t})=>t&&c.default(e,t)?void 0:r(e),ctr:(e,r,n,i)=>i?t(i,r):r}),e.create=t=>(r,...n)=>new a.Origin(t,"Json",null,{args:[],data:r,n:e.n},void 0,...n),e.cast=e=>t=>e(t,"Json")}(t.json||(t.json={}))},function(e,t){var r=Array.prototype.slice,n="function"==typeof Object.keys?Object.keys:function(e){var t=[];for(var r in e)t.push(r);return t},i=e.exports=function(e,t){return 0===e&&0===t?1/e==1/t:e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():a(e)?a(t):"object"!=typeof e&&"object"!=typeof t?e==t:function(e,t){if(s(e)||s(t))return!1;if(e.prototype!==t.prototype)return!1;if(o(e))return!!o(t)&&(e=r.call(e),t=r.call(t),i(e,t));try{var a,c,u=n(e),l=n(t)}catch(e){return!1}if(u.length!=l.length)return!1;for(u.sort(),l.sort(),c=u.length-1;c>=0;c--)if(u[c]!=l[c])return!1;for(c=u.length-1;c>=0;c--)if(a=u[c],!i(e[a],t[a]))return!1;return!0}(e,t))};function s(e){return null==e}function o(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function a(e){return"number"==typeof e&&e!=e}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.local=void 0;const o=s(r(1));!function(e){e.Handler=()=>({decode:()=>()=>({args:[],data:{},c:null,n:1}),encode:()=>()=>null,ctr:([],e)=>e}),e.create=e=>(t,...r)=>new o.Origin(e,"Local",null,{args:[],data:t,n:1},void 0,...r)}(t.local||(t.local={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createProxy=t.createCallHandler=t.startListener=t.msg2to1keys=t.msg1to2keys=void 0;const n=r(0),i=r(2),s=r(8);t.msg1to2keys={call:0,complete:0,error:0,end_call:0,put:0,unsubscribe:0},t.msg2to1keys={call_complete:0,call_error:0,response_call:0,response_id:0,response_put:0},t.startListener=(e,t,r)=>t.subscribe((function({channel:n,type:s,data:o}){var a;switch(s){case"put":{const t=e.unserialize(JSON.parse(o));return r.next({channel:n,type:"response_put",data:JSON.stringify(t)})}case"unsubscribe":const s={id:JSON.parse(o)};return null===(a=e.getValue(s)[1].subscription)||void 0===a?void 0:a.unsubscribe();case"error":{const{id:t,msg:r}=JSON.parse(o),n={id:t},i=e.getValue(n)[0];if(!i)return;return i.subject.error(r)}case"complete":{const t={id:JSON.parse(o)},r=e.getValue(t)[0];if(!r)return;return r.subject.complete()}case"call":{const s=JSON.parse(o);s.ref={id:s.argId};const{fId:a,ref:c,opt:u,param:l}=s,d=t.pipe(i.filter(e=>e.channel===n&&"end_call"===e.type)).subscribe(()=>{p.unsubscribe()}),h={error:e=>r.next({channel:n,type:"call_error",data:JSON.stringify(e)}),complete:()=>r.next({channel:n,type:"call_complete",data:""})},p=u.graph?e.call(a,l,c,{...u,graph:!0}).subscribe({...h,next:e=>{r.next({channel:n,type:"response_call",data:JSON.stringify(e)})}}):e.call(a,l,c,{...u,graph:!1}).subscribe({...h,next:e=>{r.next({channel:n,type:"response_id",data:JSON.stringify(e.id)})}});return p.add(d),void this.add(p)}}})),t.createCallHandler=(e,r,n)=>({serialized:new WeakMap,handlers:()=>{const o=n[0]++;return{end_call:()=>e.next({channel:o,type:"end_call",data:""}),unsubscribe:t=>e.next({channel:o,data:JSON.stringify(t.id),type:"unsubscribe"}),put:t=>{const o=n[0]++,a=r.pipe(i.filter(e=>e.channel===o&&"response_put"===e.type),i.take(1)).toPromise(s.QuickPromise).then(e=>JSON.parse(e.data));return e.next({channel:o,type:"put",data:JSON.stringify(t)}),a},error:(t,r)=>e.next({channel:o,type:"error",data:JSON.stringify({id:t.id,msg:""+r})}),complete:t=>e.next({channel:o,type:"complete",data:JSON.stringify(t.id)}),call:(t,r,n,i)=>e.next({channel:o,type:"call",data:JSON.stringify({fId:t,param:r,argId:n.id,opt:i})}),subscribeToResult:e=>r.pipe(i.filter(e=>e.channel===o&&e.type in t.msg2to1keys)).subscribe((function({data:t,type:r}){"response_id"===r&&e.resp_id({id:JSON.parse(t)}),"response_call"===r&&e.resp_call(JSON.parse(t)),"call_error"===r&&(e.err_call(t).then(()=>this.unsubscribe()),this.unsubscribe()),"call_complete"===r&&e.comp_call().then(()=>this.unsubscribe())}))}}}),t.createProxy=(e,r,i,s)=>{const o=new n.Subscription,a=[0],c=t.createCallHandler(i,s,a);return o.add(t.startListener(r,i,s)),o.add(e.watch(c)),{channel:a,callHandler:c,subscription:o}}}])}));