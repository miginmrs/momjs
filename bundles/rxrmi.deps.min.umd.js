!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs"),require("rxjs/operators"),require("rxjs/internal/OuterSubscriber"),require("rxjs/internal/InnerSubscriber"),require("rxjs/internal/util/subscribeToResult"),require("rxjs/internal/observable/combineLatest")):"function"==typeof define&&define.amd?define(["rxjs","rxjs/operators","rxjs/internal/OuterSubscriber","rxjs/internal/InnerSubscriber","rxjs/internal/util/subscribeToResult","rxjs/internal/observable/combineLatest"],t):"object"==typeof exports?exports.rxrmi=t(require("rxjs"),require("rxjs/operators"),require("rxjs/internal/OuterSubscriber"),require("rxjs/internal/InnerSubscriber"),require("rxjs/internal/util/subscribeToResult"),require("rxjs/internal/observable/combineLatest")):e.rxrmi=t(e.rxjs,e.rxjs.operators,e.rxjs.internal.OuterSubscriber,e.rxjs.internal.InnerSubscriber,e.rxjs.internal.util.subscribeToResult,e.rxjs.internal.observable.combineLatest)}(self,(function(e,t,r,n,i,s){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=13)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.current=t.on=t.eagerCombineAll=t.EMPTY_ARR=void 0;const n=r(0),i=r(15);class s extends n.Subscriber{notifyComplete(){var e,t;null===(t=(e=this.destination).complete)||void 0===t||t.call(e)}}t.EMPTY_ARR=n.concat(n.of([]),n.NEVER),t.eagerCombineAll=function(...e){if(0===e.length||1===e.length&&e[0]instanceof Array&&0===e[0].length)return t.EMPTY_ARR;const r=n.combineLatest.apply(this,e);return r.operator.call=function(e,t){i.CombineLatestOperator.prototype.call(e,t).notifyComplete=s.prototype.notifyComplete},r},t.on=({complete:e,error:t,next:r,subscribe:i,teardown:s})=>o=>o.lift((function(o){const a=this;null==i||i();const u=new n.Subscription;return u.add(o.subscribe(e=>{null==r||r(e),a.next(e)},e=>{null==t||t(e),a.error(e)},()=>{null==e||e(),a.complete()})),u.add(s),u})),t.current=function(e,t){return e.subscribe(e=>t=e).unsubscribe(),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.subKey=t.byKey=t.asCond=t.toCond=void 0,t.toCond=e=>e,t.asCond=e=>e,t.byKey=(e,t)=>e[t],t.subKey=e=>e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Destructable=t.destructableCmp=void 0;const n=r(0),i=r(7),s=r(2),o=r(1),a=r(3);r(2),t.destructableCmp=({compareData:e=((e,t)=>e===t),compareObs:t=((e,t)=>e===t)}={})=>(r,n)=>r.args.length===n.args.length&&r.args.every((e,r)=>{const i=e,s=n.args[r];return i instanceof Array?s instanceof Array&&(i.length===s.length&&i.every((e,t)=>e===s[t])):!(s instanceof Array)&&t(i,s)})&&e(r.data,n.data);class u extends n.Observable{constructor(e,r,a,u,c=t.destructableCmp(),...l){super(),this.handlers=e,this.key=r,this.c=a,this.origin=this,this.parent=this;const d=this.handler;this.subject=new n.BehaviorSubject(u),this.destroy=new n.Subscription(()=>{this.subject.isStopped?this.subject.closed=!0:this.subject.unsubscribe()}),l.forEach(e=>this.destroy.add(e)),this.source=new n.Observable(e=>{const t=this.subject.pipe(o.distinctUntilChanged(c),i.alternMap(({args:e,data:t})=>{const r=e.map(e=>e instanceof Array?s.eagerCombineAll(e):e);return s.eagerCombineAll(r).pipe(o.map(e=>[e,t,a]))},{completeWithInner:!0,completeWithSource:!0}),o.tap(void 0,e=>this.subject.error(e),()=>this.subject.complete()),o.scan((e,[t,r,n])=>d.ctr(t,r,n,e),null)).subscribe(e);return t.add(this.destroy),t}),this.operator=o.shareReplay({bufferSize:1,refCount:!0})(this).operator}get destroyed(){return this.destroy.closed}get handler(){return a.byKey(this.handlers,this.key)}}t.Destructable=u},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.map=s(r(16))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickPromise=void 0;const n=r(0);var i;!function(e){e[e.Pending=0]="Pending",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected",e[e.Alias=3]="Alias"}(i||(i={}));class s{constructor(e){this._thens=[],this._catchs=[],this._status=i.Pending,e(e=>{var t;if(this._status===i.Pending)if(null==(t=e)?void 0:t.then)this._status=i.Alias,this._promise=e,e.then(this._finilize(this._thens),this._finilize(this._catchs));else{const t=e;this._value=t,this._status=i.Resolved,this._finilize(this._thens)(t)}},e=>{this._status===i.Pending&&(this._error=e,this._status=i.Rejected,this._finilize(this._catchs)(e))})}_finilize(e){return t=>{e.forEach(e=>e(t)),this._thens=[],this._catchs=[]}}_tryRun(e,t,r){return n=>{try{const s=e(n);if(null==(i=s)?void 0:i.then)s.then(t,r);else{t(s)}}catch(e){r(e)}var i}}then(e,t){const r=null!=e?e:n.identity;return new s((e,n)=>{if(this._status===i.Pending)this._thens.push(this._tryRun(r,e,n)),t?this._catchs.push(this._tryRun(t,e,n)):this._catchs.push(n);else if(this._status===i.Alias){this._promise.then(this._tryRun(r,e,n),t?this._tryRun(t,e,n):n)}else this._status===i.Resolved?this._tryRun(r,e,n)(this._value):t?this._tryRun(t,e,n)(this._error):n(this._error)})}catch(e){return this.then(null,e)}finally(e){if(!e)return this;const t=()=>{try{e()}catch(e){}};return this._status===i.Alias?this._promise.then(t,t):this._status===i.Pending?(this._thens.push(t),this._catchs.push(t)):t(),this}static resolve(e){return new s(t=>t(e))}static reject(e){return new s((t,r)=>r(e))}static all(e){const t=e instanceof Array?[...e]:{...e},r=Object.keys(e).filter(t=>e[t].then);let n=r.length;return new s((i,s)=>{n||i(t),r.forEach(r=>{e[r].then(e=>{t[r]=e,--n||i(t)},s)})})}}t.QuickPromise=s},function(e,t,r){"use strict";r.r(t),r.d(t,"alternMap",(function(){return u}));var n=r(0),i=r(1),s=r(10),o=r(11),a=r(12);function u(e,t,r){return"function"==typeof r?s=>s.pipe(u((t,s)=>Object(n.from)(e(t,s)).pipe(Object(i.map)((e,n)=>r(t,e,s,n))),t)):r=>r.lift(new c(e,t||{}))}class c{constructor(e,t){this.project=e,this.options=t}call(e,t){return t.subscribe(new l(e,this.project,this.options))}}class l extends s.OuterSubscriber{constructor(e,t,r){super(e),this.project=t,this.options=r,this.index=0}_next(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this._innerSub(t,e,r)}_innerSub(e,t,r){const n=this.innerSubscription,i=new o.InnerSubscriber(this,t,r),s=this.destination;s.add(i),this.innerSubscription=Object(a.subscribeToResult)(this,e,void 0,void 0,i),this.innerSubscription!==i&&s.add(this.innerSubscription),n&&n.unsubscribe()}_complete(){const{innerSubscription:e}=this;(!e||e.closed||this.options.completeWithSource)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=null}notifyComplete(e){this.destination.remove(e),this.innerSubscription=null,(this.isStopped||this.options.completeWithInner)&&super._complete()}notifyNext(e,t,r,n,i){this.destination.next(t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineProperty=void 0,t.defineProperty=function(e,t,r){return Object.defineProperty(e,t,r)}},function(e,t,r){"use strict";r.r(t),r.d(t,"iterate",(function(){return s})),r.d(t,"asyncMap",(function(){return o})),r.d(t,"iterateMap",(function(){return a}));var n=r(0);class i{*iterator(e=this.head){for(;e;)yield e,e=e.next}[Symbol.iterator](){return this.iterator()}unshift(e){const t=this.head,r=this.head={value:e,next:t,list:this};return t&&(t.prev=this.head),this.tail||(this.tail=this.head),r}remove(e){this.head===e&&(this.head=e.next),this.tail===e&&(this.tail=e.prev),e.next&&(e.next.prev=e.prev,e.next=void 0),e.prev&&(e.prev.next=e.next,e.prev=void 0)}}const s=async(e,t,r)=>{let i=!1,s=await e.next();for(r&&r(()=>{i=!0,e.next(!0).catch(n.noop)});!i&&!s.done;){const r=t&&t();r?await r:s=await e.next(!1)}return!i&&s.done?{ok:!0,value:s.value}:{}},o=(e,{handleException:t,wait:r=!1,mode:s="concurrent"}={})=>o=>new n.Observable(a=>{let u=n.Subscription.EMPTY;const c="merge"===s,l="recent"===s,d=new i,h=!c&&!l,p="switch"===s,f=new WeakMap,b=new WeakMap,y=o.subscribe({next:r=>{const i=u,s=u=new n.Subscription,o=d.unshift();f.set(o,new Promise(e=>b.set(o,e))),s.add(()=>d.remove(o));const l=e(r,o,{get closed(){return s.closed}},()=>h&&o.next?f.get(o.next):void 0,e=>s.add(e)).then(void 0,e=>({ok:!1,error:e}));if(s.add(Object(n.from)(l).subscribe(({ok:e,value:r,error:n})=>{if(!e){if(n&&t){const e=t(n);e.ok&&a.next(e.value)}return d.remove(o),b.get(o)(),i.add(s)}a.next(r),c?i.add(s):s.unsubscribe()})),p)return i.unsubscribe();s.add(i)},error:e=>a.error(e),complete:()=>u.add(()=>a.complete())}),v=r?new n.Subscription:y;return r&&v.add(y),v.add(()=>u.unsubscribe()),v}),a=(e,t={mode:"concurrent"})=>o((t,r,n,i,o)=>s(e(t,r,n),i,o),t)},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),s(r(14),t),s(r(17),t),s(r(4),t),s(r(19),t),s(r(20),t),s(r(5),t),t.rx_async=o(r(9)),t.altern_map=o(r(7)),t.utils=o(r(21))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Store=t.BiMap=t.asAsync=t.wait=t.runit=void 0;const n=r(0),i=r(4),s=r(3),o=r(5),a=r(2),u=r(8),c=r(1),l=r(7),d=r(9),{depMap:h}=o.map;function*p(e){return yield e}function f(e,r,n){return(...i)=>t.runit(e.call(n,...i),r)}t.runit=(e,t)=>{const r=(...n)=>{const i=n.length?e.next(n[0]):e.next();return i.done?t.resolve(i.value):t.resolve(i.value).then(r)};return r()},t.wait=p,t.asAsync=f;class b{constructor(){this.byId=new Map,this.byObs=new Map,this.oldId=new WeakMap}get(e){return this.byId.get(e)}delete(e){const t=this.byId.get(e);return t&&this.byObs.delete(t[0].origin),this.byId.delete(e)}set(e,t){this.byObs.set(t[0].origin,e),this.oldId.set(t[0].origin,e),this.byId.set(e,t)}reuseId(e,t){this.oldId.set(e,t)}find(e){return this.byObs.get(e)}usedId(e){return this.oldId.get(e)}get size(){return this.byId.size}keys(){return this.byId.keys()}entries(){return this.byId.entries()}values(){return this.byId.values()}}t.BiMap=b;const y=BigInt(1);t.Store=class{constructor(e,r,n,i){this.handlers=e,this.extra=r,this.promiseCtr=n,this.name=i,this.map=new b,this.next=y,this.ref=e=>({id:this.map.find(e)}),this.checkTypes=(e,...t)=>{const r=()=>new Error("Type Mismatch : "+e.origin.key+" not in "+JSON.stringify(h(t[0],e=>e instanceof Array?e[0]:e)));if(1===t.length){if(t[0].length&&!t[0].some(([t,r])=>e.origin.handler===s.byKey(this.handlers,t)&&e.origin.c===r))throw r()}else{const n=this.handlers;if(t[0].length&&!t[0].some(t=>e.origin.handler===s.byKey(n,t)))throw r()}return e},this.getter=e=>{if(!("id"in e))throw new Error("There is no local context");return this.map.get(e.id)[0]},this.xderef=e=>(t,...r)=>this.checkTypes(e(t),r),this.deref=e=>(t,...r)=>this.checkTypes(e(t),r,0),this.emptyContext={deref:this.deref(this.getter),xderef:this.xderef(this.getter),ref:this.ref,...this.extra},this.waiting={push:new WeakMap,serialize:new WeakMap},this.resolvers={push:new WeakMap,serialize:new WeakMap},this.getResolver=(e,t)=>{let r;const n=new this.promiseCtr(e=>r=e);return this.waiting[t].set(e,n),this.resolvers[t].set(e,r),n.then(()=>{this.waiting[t].delete(e),this.resolvers[t].delete(e)}),r},this.serialize=(e,r,n=!0)=>e.pipe(c.scan(f((function*(t){const i=new b,s=new Map;let o=1;const u=e=>("id"in e?this.map.get(e.id):i.get(e.$))[0],c=new Map,l=e=>void 0!==this.map.find(e),d=e=>{if(c.has(e))return;const t=e.subject.value;c.set(e,{data:a.current(e),entry:t}),t.args.forEach(e=>{e instanceof Array?e.forEach(d):d(e)})};d(e);const h=a=>f((function*(){let{data:u,entry:d}=c.get(a);yield this.waiting.serialize.get(a);const h=this.map.find(a),f=void 0===h?null==r?void 0:r(a):void 0;let b,v=void 0;if(void 0!==h&&t){const[,e]=yield*p(t);v=e.get(a)}const m=v?{old:v.data}:{},g=()=>a.handler.encode(y)({...d,c:a.c,...m});if(v&&(b={data:yield*p(g())},void 0===b.data))return s.set(a,v),{id:h};const _=i.find(a),j=null!=_?_:a===e?0:o++;if(void 0===_){b||(i.set(j,[a,null]),b={data:yield*p(g())}),s.set(a,b);const e=this.map.usedId(a),r={type:a.key,value:u,...b,c:a.c,id:e};f&&(r.resolve=f),r.new=0===j&&null===t&&(n||!l(a)),i.set(j,[a,r])}return{$:j}}),this.promiseCtr,this)(),y={deref:this.deref(u),xderef:this.xderef(u),ref:h,...this.extra};return[i,s,yield*p(this.promiseCtr.resolve(h(e)))]}),this.promiseCtr,this),null),d.asyncMap(e=>t.runit(function*(){return e?{ok:!0,value:yield*p(e)}:{}}(),this.promiseCtr),{mode:"merge",wait:!0}),c.map(([e,,t])=>{const r=Array(e.size).fill(0).map((t,r)=>e.get(r));if(0===r.length){if("$"in t)throw new Error("Unexpected");return null}return r.map(([,e],t)=>{const r={i:t,...e};return delete r.value,r})}),c.filter(e=>null!==e)),this.functions=[],this.callReturnRef=new WeakMap}getNext(e){if(void 0===e)return""+this.next++;const t=BigInt(e);return this.next<=t&&(this.next=t+y),e}findRef(e){const t=this.map.find(e);return"string"==typeof t?{id:t}:t}_unserialize(e,t,r,n,i){const o=s.byKey(this.handlers,e);if(void 0!==n[i])return n[i];const a=r[i],{id:u}=a;if(void 0===a.data)throw new Error("Trying to access a destructed object");const c=this.getNext(u),l=o.decode(t)(c,a.data);if(void 0!==u){const e=this.map.get(u);if(void 0!==e){const t=e[0].origin;if(t.key!==a.type||t.c!==a.c)throw new Error("Trying to update a wrong type");t.subject.next(l);return{id:u,obs:t,subs:e[1].subscription}}}const d=this._insert(e,l,t,c,a.c);return n[i]={obs:d,id:c},n[i]}_insert(e,t,r,n,o){var a,u;const c=s.byKey(this.handlers,e),l=null===(a=c.compare)||void 0===a?void 0:a.call(c,r),d=new i.Destructable(this.handlers,e,o,t,l,null===(u=c.destroy)||void 0===u?void 0:u.call(c,r)(t.data),()=>this.map.delete(n));return this.map.set(n,[d,{}]),d}unserialize(e){const t=[],r=e instanceof Function?e(e=>({$:e})):e,n=e=>{const n=r[e],i=Object.assign(r,{[e]:n});return{...this._unserialize(n.type,o,i,t,e),m:n}},i=e=>"id"in e?this.map.get(e.id)[0]:n(e.$).obs,s=this.ref,o={deref:this.deref(i),ref:s,xderef:this.xderef(i),...this.extra},a=[],u=[];try{const e=h(r,({i:e},t)=>{e=t;const{obs:r,id:i,subs:s,m:o}=n(e),c=!1!==o.new;if(c&&void 0!==s)throw new Error("Trying to subscribe to an already subscribed entity");c?a.push(this.map.get(i)[1].subscription=r.subscribe(()=>{})):r.subject.isStopped||u.push(r.subscribe(()=>{}));return{id:i}});return u.forEach(e=>e.unsubscribe()),e}catch(e){throw u.concat(a).forEach(e=>e.unsubscribe()),e}}append(e,t,r){const n=this.getNext(),i=this._insert(e,t,this.emptyContext,n,r),s=this.map.get(n)[1].subscription=i.subscribe(()=>{});return{id:n,obs:i,subs:s}}push(e,{ids:t,init:r,unload:i}={}){return f((function*(){var s;null==r||r(e.origin),yield*p(this.waiting.push.get(e.origin));const o=this.map.find(e.origin),h=this.getNext(null!==(s=null!=o?o:null==t?void 0:t.get(e.origin))&&void 0!==s?s:this.map.usedId(e.origin));let b,y,v=e,m=new this.promiseCtr(e=>y=e);if(void 0===o){let s=!1;const o=[],g=()=>{o.forEach(e=>e.unsubscribe()),o.length=0};v=u.defineProperty(Object.assign(a.eagerCombineAll(e,e.origin.subject.pipe(c.scan((e,{args:n,n:i})=>{const s=f((function*(e){const n=yield*p(this.push(e,{ids:t,init:r}));return o.push(n.subscription),n.wrapped}),this.promiseCtr,this),u=2===i?n.map(e=>this.promiseCtr.all(e.map(s)).then(a.eagerCombineAll)):n.map(s),c=this.promiseCtr.all(u).then(a.eagerCombineAll);return e||c.then(y),e?e.then(()=>c):c},null),d.asyncMap(e=>e.then(e=>({ok:!0,value:e}))),l.alternMap(n.identity,{completeWithInner:!0}),c.tap(g),c.distinctUntilChanged((e,t)=>e.length===t.length&&e.every((e,r)=>{const n=t[r];return e instanceof Array&&n instanceof Array?e.length===n.length&&e.every((e,t)=>e===n[t]):e===n})))).pipe(c.finalize(()=>{null==i||i(),g(),this.map.delete(h),s=!0}),c.map(([e])=>e),c.shareReplay({bufferSize:1,refCount:!0})),{origin:e.origin,parent:e}),"destroyed",{get:()=>s}),this.map.set(h,[v,{}]),b=v.subscribe(),yield*p(m)}else v=this.map.get(h)[0],b=v.subscribe();return{ref:{id:h},wrapped:v,subscription:b}}),this.promiseCtr,this)()}get(e){return this.map.get(e)}getValue({id:e}){const t=this.get(e);if(void 0===t)throw new Error("Access to destroyed object");return t}local(e,t,r){const i=this.functions[e](t,this.getValue(r)[0]);return this.push(i).then(({subscription:e})=>{const t=this.serialize(i);return new n.Observable(r=>{r.add(e),r.add(t.subscribe(r))})})}remote(){return(e,t,r,{handlers:i,serialized:s})=>new n.Observable(o=>{f((function*(){const a=e=>[new this.promiseCtr(t=>e=t),e],[u,l]=a(),h=new n.Subscription;yield*p(this.waiting.serialize.get(t));const b=i();let y=s.get(t);y||s.set(t,y=this.serialize(t,e=>{const t=this.getResolver(e,"serialize");return r=>{this.map.reuseId(e,r.id),t(r)}},!1).pipe(d.asyncMap(f((function*(e){const t=b.next();b.put(e);const r=yield*p(t);r.forEach((t,r)=>{var n,i;return null===(i=null===(n=e[r])||void 0===n?void 0:n.resolve)||void 0===i?void 0:i.call(n,t)});return{ok:!0,value:r[0]}}),this.promiseCtr,this)),c.tap(void 0,e=>u.then(t=>b.error(t,e)),()=>u.then(e=>b.complete(e))),c.shareReplay({refCount:!0,bufferSize:1})));const v=y.subscribe(e=>l(e)),m=a();this.callReturnRef.set(o,m[0]),u.then(e=>{if(h.add(()=>{v.closed||v.unsubscribe()}),!v.closed)return this.push(t,{init:e=>{void 0===this.map.usedId(e)&&this.getResolver(e,"push")},unload:()=>b.call_unsubscribe(e)}).then(({wrapped:t,subscription:r})=>({refArg:e,wrapped:t,subscription:r}));h.unsubscribe()}).then(t=>{if(!t)return;const{refArg:n,subscription:i,wrapped:s}=t,o=s.subscribe();i.unsubscribe(),h.add(()=>o.unsubscribe());const a=b.subscribeToResult({resp_call:e=>{var t;const r=this.unserialize(e)[0];a.add(null===(t=this.get(r.id))||void 0===t?void 0:t[1].subscription),m[1](r)},err_call:e=>m[0].then(t=>{this.getValue(t)[0].subject.error(e)}),comp_call:()=>m[0].then(e=>{this.getValue(e)[0].subject.complete()})});return h.add(()=>{a.closed||b.end_call()}),h.add(a),a.add(h),b.call(e,r,n),m[0]}).then(e=>{if(!e)return;const t=this.getValue(e)[0].subscribe(o);h.add(()=>t.unsubscribe())}),o.add(h)}),this.promiseCtr,this)()})}}},function(e,t){e.exports=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncDepMap=t.depMap=t.conf=void 0,t.conf={Promise:Promise},t.depMap=(e,t)=>{const r=[];return e.forEach((e,n)=>r[n]=t(e,n)),r},t.asyncDepMap=(e,r,n=t.conf.Promise)=>{const i=[];return n.all(e.map((e,t)=>n.resolve(r(e,t)).then(e=>i[t]=e))).then(()=>i)}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=t.wrapJson=t.JsonHandler=t.JsonCtr=t.toArray=t.wrapArray=t.ArrayHandler=t.ArrayCtr=void 0;const i=r(4),s=r(5),o=r(3),a=n(r(18)),u=r(6),{asyncDepMap:c}=s.map;t.ArrayCtr=(e,t,r,n)=>(n&&(n.splice(0),e=Object.assign(n,e)),e),t.ArrayHandler=()=>({decode:({deref:e})=>(t,r)=>({args:r.map(t=>e(t)),data:null,n:1}),encode:({ref:e})=>({args:t})=>c(t,e,u.QuickPromise).then(e=>o.toCond(e)),ctr:t.ArrayCtr}),t.wrapArray=(e,t,...r)=>new i.Destructable(t,"Array",null,{data:null,args:e,n:1},void 0,...r),t.toArray=e=>t=>e(t,"Array");const l=(e,t)=>{const r=e=>Object.keys(e),n=new Set(r(e));for(const i of r(t)){n.delete(i);const r=e[i],s=t[i];r&&s&&"object"==typeof r&&"object"==typeof s&&Array.isArray(r)===Array.isArray(s)?l(r,s):e[i]=s}for(const t of n)delete e[t];return e};t.JsonCtr=(e,t,r,n)=>n?l(n,t):t;const d=e=>null===e?e:e instanceof Array?e.map(d):"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,t])=>[e,d(t)])):e;t.JsonHandler=()=>({decode:()=>(e,t)=>({args:[],data:t,n:1}),encode:()=>({data:e,old:t})=>t&&a.default(e,t)?void 0:d(e),ctr:t.JsonCtr}),t.wrapJson=(e,t,...r)=>new i.Destructable(t,"Json",null,{args:[],data:e,n:1},void 0,...r),t.toJson=e=>t=>e(t,"Json")},function(e,t){var r=Array.prototype.slice,n="function"==typeof Object.keys?Object.keys:function(e){var t=[];for(var r in e)t.push(r);return t},i=e.exports=function(e,t){return 0===e&&0===t?1/e==1/t:e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():a(e)?a(t):"object"!=typeof e&&"object"!=typeof t?e==t:function(e,t){if(s(e)||s(t))return!1;if(e.prototype!==t.prototype)return!1;if(o(e))return!!o(t)&&(e=r.call(e),t=r.call(t),i(e,t));try{var a,u,c=n(e),l=n(t)}catch(e){return!1}if(c.length!=l.length)return!1;for(c.sort(),l.sort(),u=c.length-1;u>=0;u--)if(c[u]!=l[u])return!1;for(u=c.length-1;u>=0;u--)if(a=c[u],!i(e[a],t[a]))return!1;return!0}(e,t))};function s(e){return null==e}function o(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function a(e){return"number"==typeof e&&e!=e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCallHandler=t.startListener=void 0;const n=r(1),i=r(6);t.startListener=(e,t,r)=>t.subscribe((function({channel:i,type:s,data:o}){var a,u,c,l;switch(s){case"put":{const t=e.unserialize(JSON.parse(o));return r.next({channel:i,type:"response_put",data:JSON.stringify(t)})}case"unsubscribe":return null===(u=null===(a=e.get(o))||void 0===a?void 0:a[1].subscription)||void 0===u?void 0:u.unsubscribe();case"error":{const{id:t,msg:r}=JSON.parse(o),n=null===(c=e.get(t))||void 0===c?void 0:c[0];if(!n)return;return n.subject.error(r)}case"complete":{const t=null===(l=e.get(o))||void 0===l?void 0:l[0];if(!t)return;return t.subject.complete()}case"call":{const{fId:s,param:a,argId:u}=JSON.parse(o);return void e.local(s,a,{id:u}).then(e=>{const s=t.pipe(n.filter(e=>e.channel===i&&"end_call"===e.type)).subscribe(()=>{o.unsubscribe()}),o=e.subscribe(e=>{r.next({channel:i,type:"response_call",data:JSON.stringify(e)})},e=>{r.next({channel:i,type:"call_error",data:""+e})},()=>{r.next({channel:i,type:"call_complete",data:""})});o.add(s),this.add(o)})}}})),t.createCallHandler=(e,t,r)=>({serialized:new WeakMap,handlers:()=>{const s=r[0]++,o=r[0]++;return{end_call:()=>e.next({channel:o,type:"end_call",data:""}),call_unsubscribe:t=>e.next({channel:s,data:t.id,type:"unsubscribe"}),complete:t=>e.next({channel:s,data:t.id,type:"complete"}),put:t=>e.next({channel:s,type:"put",data:JSON.stringify(t)}),call:(t,r,n)=>e.next({channel:o,data:JSON.stringify({fId:t,param:r,argId:n.id}),type:"call"}),error:(t,r)=>e.next({channel:s,data:JSON.stringify({id:t.id,msg:""+r}),type:"error"}),next:()=>t.pipe(n.filter(e=>e.channel===s),n.take(1)).toPromise(i.QuickPromise).then(e=>JSON.parse(e.data)),subscribeToResult:e=>t.pipe(n.filter(e=>e.channel===o)).subscribe((function({data:t,type:r}){"response_call"===r&&e.resp_call(JSON.parse(t)),"call_error"===r&&(e.err_call(t).then(()=>this.unsubscribe()),this.unsubscribe()),"call_complete"===r&&e.comp_call().then(()=>this.unsubscribe())}))}}})},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var o=r(8);Object.defineProperty(t,"defineProperty",{enumerable:!0,get:function(){return o.defineProperty}}),t.guards=s(r(3));var a=r(6);Object.defineProperty(t,"QuickPromise",{enumerable:!0,get:function(){return a.QuickPromise}}),t.rx_utils=s(r(2))}])}));